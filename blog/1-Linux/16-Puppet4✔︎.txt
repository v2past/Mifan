ğŸ”µ ç®€ä»‹
                                  â¤ï¸â¤ï¸ï¸â¤ï¸ Puppet æå“å…¥é—¨æ•™ç¨‹ â¤ï¸â¤ï¸â¤ï¸
     http://www.zsythink.net/archives/category/%E8%BF%90%E7%BB%B4%E7%9B%B8%E5%85%B3/puppet/

                â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸å®‰è£…puppet-server ä¼šè‡ªåŠ¨å®‰è£… puppet-agent.â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸
                â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸å®‰è£…puppet-server ä¼šè‡ªåŠ¨å®‰è£… puppet-agent.â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸
                          ä¸ç®¡ä»€ä¹ˆç”µè„‘è¦ç”¨puppetå®‰è£… puppet-server å°±å¯¹äº†.
                           æ‰€ä»¥: æœåŠ¡å™¨å°½é‡å®‰è£…æœ€æ–°ç‰ˆæœ¬. å®¢æˆ·ç«¯ç›¸å¯¹æ— æ‰€è°“.


                        ğŸ“Œåˆ«åœ¨Macä¸ŠæŠ˜è…¾ puppet-agent. æˆ‘åæ­£åŠå¤©æ²¡æŠ˜è…¾æˆåŠŸğŸ“Œ
    ğŸ”¸ç›®çš„: åœ¨æ— å…¬ç½‘IPçš„Centos7è™šæ‹Ÿæœºä¸Šæ­å»º puppet-server æœåŠ¡å™¨. æ§åˆ¶æœ‰å…¬ç½‘IPçš„ vps.(puppet-agent)ğŸ”¸






ğŸ”µ ä¸‰ä¸ªç»„ä»¶:
    ğŸ”¸puppet-server    Puppet Server. ä¼šè‡ªåŠ¨å®‰è£… puppet-agent!!!
    ğŸ”¸puppet-agent     å¤šåˆä¸€å®‰è£…åŒ….ä¼šå®‰è£… Puppet-agent, Ruby, Facter.ç­‰å„ç§ä¾èµ–.
                       ğŸ‘â€ğŸ—¨Facter è·å–å®¢æˆ·ç«¯æ•°æ®å¹¶ä¼ ç»™æœåŠ¡å™¨.
    ğŸ”¸puppetdb         æ•°æ®åº“. å¯ä»¥æ›´å¥½çš„ä½¿ç”¨ puppet.

        Puppet: C/Sæ¶æ„è½¯ä»¶.
            ğŸ“ŒæœåŠ¡å™¨ä¸€èˆ¬è¦å®‰è£… puppet-server
            ğŸ“Œå®¢æˆ·ç«¯ä¸€èˆ¬ä¹Ÿå®‰è£… puppet-server åæ­£ä¼šè‡ªåŠ¨å®‰è£…puppet-agentçš„.       


ğŸ”µ ç›®å½•
    ğŸ”¸è½¯ä»¶å®‰è£…ç›®å½•               /opt/puppetlabs
    ğŸ”¸æ‰§è¡Œæ–‡ä»¶ç›®å½•               /opt/puppetlabs/bin
    ğŸ”¸puppet-agent  é…ç½®æ–‡ä»¶     /etc/puppetlabs/puppet/puppet.conf    
    ğŸ”¸puppet-server é…ç½®æ–‡ä»¶     /etc/puppetlabs/puppetserver/puppetserver.conf
    ğŸ”¸agent  sslè¯ä¹¦å­˜æ”¾ç›®å½•         /etc/puppetlabs/puppet/ssl            
    ğŸ”¸server sslè¯ä¹¦å­˜æ”¾ç›®å½•         /etc/puppetlabs/puppetserver/ssl            
    ğŸ”¸æ‰€æœ‰çš„module/manifest/dataä»confdir ç§»åˆ°/etc/puppetlabs/code
        åŒ…å«environmentsç›®å½•
        åŒ…å«å…¨å±€çš„modulesç›®å½•



ğŸ”µ Puppet å·¥ä½œæµç¨‹

    puppetæ˜¯æ‰¹é‡ç®¡ç†æœåŠ¡å™¨çš„, æ¯”å¦‚è¦å®‰è£…/è¾“å‡º/æ›´æ–°è½¯ä»¶ã€æ–°å»º/åˆ é™¤ç”¨æˆ·ã€å¯åŠ¨/åœæ­¢è¿›ç¨‹...
    æ‰€æœ‰çš„é…ç½®æ–‡ä»¶éƒ½æ˜¯å‚¨å­˜åœ¨æœåŠ¡å™¨ä¸­.å®¢æˆ·ç«¯æ¯åŠå°æ—¶è¿ä¸€æ¬¡æœåŠ¡å™¨. çœ‹æœåŠ¡å™¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰æ›´æ–°.
    å¦‚æœæœ‰æ›´æ–°.å°±ä¸‹è½½é…ç½®æ–‡ä»¶.ç„¶ååœ¨æœ¬åœ°æ‰§è¡Œ

    å®¢æˆ·ç«¯çš„facter ä¼šè·å–å®¢æˆ·ç«¯è‡ªå·±ç”µè„‘çš„ä¿¡æ¯(å¦‚ä¸»æœºåï¼Œå†…å­˜å¤§å°ï¼Œipåœ°å€ç­‰) å‘é€ç»™æœåŠ¡å™¨.
    æœåŠ¡å™¨çš„facter æ ¹æ®å®¢æˆ·ç«¯ä¸»æœºå.åœ¨æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°å¯¹åº”çš„é…ç½®.æ¥åˆ†æå®¢æˆ·ç«¯æ˜¯å¦æˆåŠŸæ‰§è¡Œ

    å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ˜¯åŸºäºSSLè¯ä¹¦çš„.
    ä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥è¯·æ±‚è¿æ¥æœåŠ¡å™¨. ä½†æ˜¯åªæœ‰åœ¨æœåŠ¡å™¨åŒæ„åæ‰å¯ä»¥å’ŒæœåŠ¡å™¨é€šä¿¡!!

    puppet  ä¼šè®©ç³»ç»Ÿä¿æŒåœ¨äººä»¬æ‰€æœŸæœ›çš„æŸç§çŠ¶æ€å¹¶ä¸€ç›´ç»´æŒä¸‹å».ä¾‹å¦‚ï¼š
        ä¿è¯æŸä¸ªæ–‡ä»¶ä¸€ç›´å­˜åœ¨ï¼Œ å¦‚æœè¯¥æ–‡ä»¶è¢«åˆ é™¤äº†   puppetä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰ä¼šé‡æ–°åˆ›å»ºæ–‡ä»¶.
        ä¿è¯sshæœåŠ¡å§‹ç»ˆå¼€å¯ï¼Œ  å¦‚æœsshæœåŠ¡è¢«å…³é—­äº†  puppetä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰ä¼šé‡å¯sshæœåŠ¡.





ğŸ”µ å¸¸ç”¨å‘½ä»¤

    ğŸ”…puppet help æŸ¥çœ‹å„ç§å‘½ä»¤.

    ğŸ”…puppet help agent              æŸ¥çœ‹agentè¯¥å­å‘½ä»¤çš„è¯¦ç»†ç”¨æ³•.
        puppet agent -V/--version    æŸ¥çœ‹ç‰ˆæœ¬
        puppet agent --verbose/-v    è¯¦ç»†è¾“å‡ºå‘½ä»¤.  
        puppet agent --test / -t     æµ‹è¯•è¿æ¥.
        puppet agent --noop          æ¨¡æ‹Ÿè¿è¡Œ.

    ğŸ”¸è¯ä¹¦ç›¸å…³å‘½ä»¤:.
        puppet cert list                     åˆ—å‡ºæœªç­¾åè¯·æ±‚. (æœªç­¾åæœ€å‰é¢æ²¡æœ‰+å·)
        puppet cert list --all               åˆ—å‡ºæ‰€æœ‰çš„ç­¾å. åŒ…æ‹¬å·²ç­¾åçš„(å·²ç­¾åæœ€å‰é¢æœ‰ä¸ª+å·)
        puppet cert sign host2.example.com   ç»™æŸä¸ªå®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œç­¾å(æœåŠ¡å™¨ä¸Šæ“ä½œ).
        puppet cert sign --all               ç»™æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œç­¾å(æœåŠ¡å™¨ä¸Šæ“ä½œ).


        ss -tlunp | grep puppet           æŸ¥çœ‹puppetçš„ç«¯å£ é»˜è®¤8140
        ğŸ‘â€ğŸ—¨ å‡çº§ç‰ˆæœ¬. å…ˆå¸è½½(yum remove puppet-server) å†å®‰è£…






â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¤ï¸è½¯ä»¶å®‰è£…â¤ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸

â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¤ï¸è½¯ä»¶å®‰è£…â¤ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
â¤ï¸CentOS6 å®‰è£… (è¯¦ç»†)

    ğŸ”µä¾èµ–ç¯å¢ƒ
        ğŸ”¸ lsb_release -a                æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬. âœ  Description:	CentOS release 6.9 (Final)
        ğŸ”¸ uname -a                      æŸ¥çœ‹ç³»ç»Ÿæ˜¯32ä½è¿˜æ˜¯64ä½. åªæœ‰è¾“å‡ºæ˜¯x86_64 æ‰æ˜¯64ä½çš„. å…¶ä»–éƒ½æ˜¯32ä½çš„!!!!
        ğŸ”¸ yum install ruby ruby-rdoc    å®‰è£…rubyç¯å¢ƒ.
        ğŸ”¸ æ·»åŠ puppet çš„å®˜æ–¹yumæº.
            rpm -ivh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-6.noarch.rpm
            â—ï¸â—ï¸è¿™ä¸ªPC1æº(Puppet Collections)æ‰å¯ä»¥å®‰è£…4.+ç‰ˆæœ¬ â—ï¸â—ï¸

                    rpm -ivh http://yum.puppetlabs.com/puppetlabs-release-el-6.noarch.rpm
                    ğŸ‘â€ğŸ—¨ è¿™ä¸ªæºæœ€é«˜åªèƒ½å®‰è£… 3.8.7çš„ç‰ˆæœ¬!! åˆ«ç”¨è¿™ä¸ªæº.

                    ğŸ‘¹ package puppetlabs-release-22.0-2.noarch is already installed
                    å¦‚æœå‡ºç° xxx is already installed ç±»ä¼¼æç¤º.  ç”¨ rpm --force -i  âœš ç½‘å€ å¼ºåˆ¶å®‰è£….
                    rpm --force -i https://yum.puppetlabs.com/puppetlabs-release-pc1-el-6.noarch.rpm

    ğŸ”µå®‰è£…puppet-server
        ğŸ”¸yum install puppetserver
            ğŸ‘â€ğŸ—¨ 4+ ç‰ˆæœ¬å’Œ3+çš„å®‰è£…å‘½ä»¤æ˜¯ä¸ä¸€æ ·çš„ 3+ çš„å¥½åƒæ˜¯: yum install puppetmaster
            Serveré»˜è®¤å¯¹å†…å­˜è¦æ±‚é«˜å¾—2G... 256mçš„vpsè·‘ä¸ªå®¢æˆ·ç«¯å°±å¯ä»¥äº†åˆ«è·‘æœåŠ¡ç«¯äº†...
        ğŸ”¸ é…ç½®ç¯å¢ƒè·¯å¾„
                å®‰è£…å¥½åä½ ä¼šå‘ç°ä¸èƒ½æ‰§è¡Œpuppetå‘½ä»¤!
                    ğŸ‘â€ğŸ—¨ å¦‚æœä½ ç”¨çš„æ˜¯ 3.8.7 çš„é‚£ä¸ªæºæ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨puppetå‘½ä»¤çš„.ä¹Ÿå°±ä¸éœ€è¦é…ç½®ç¯å¢ƒè·¯å¾„. 
                æ­£å¸¸ puppet agent -V å°±èƒ½æ˜¾ç¤ºå½“å‰å®¢æˆ·ç«¯ç‰ˆæœ¬çš„.
                ğŸ“ŒPuppet4 çš„å˜åŒ–æ¯”è¾ƒå¤§. 
                    ğŸ‘â€ğŸ—¨ é…ç½®è·¯å¾„: /etc/pupperlabs
                    ğŸ‘â€ğŸ—¨ ç¨‹åºè·¯å¾„: /opt/puppetlabs
                ç›´æ¥å»ç¨‹åºå®‰è£…è·¯å¾„å»çœ‹çœ‹èƒ½ä¸èƒ½æ‰§è¡Œ.
                cd /opt/puppetlabs/bin
                ./puppet agent -V
                    è¿™ä¸‹å°±æ˜¾ç¤ºå‡ºå½“å‰ç‰ˆæœ¬äº†!è¯´æ˜å®‰è£…æˆåŠŸçš„.è‡ªå·±é…ä¸‹ç¯å¢ƒè·¯å¾„å°±å¥½äº†. 
                    è¿™ä¸€è¿™ä¸ªå‘½ä»¤å‰çš„ ./ è¿™ä¸ªè¡¨ç¤ºå½“å‰æ–‡ä»¶å¤¹!!!!

                ä¸‹é¢æˆ‘ä»¬æ‰‹åŠ¨æŠŠ /opt/puppetlabs/bin   è¿™ä¸ªè·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒè·¯å¾„ä¸­!!
                ä»¥åä»»ä½•ä½ç½®éƒ½å¯ä»¥è¿è¡Œpuppetå‘½ä»¤äº†. è€Œä¸æ˜¯å¿…é¡»cdåˆ°puppetçš„å®‰è£…è·¯å¾„ä¸‹æ‰èƒ½è¿è¡Œpuppetå‘½ä»¤.
                ç¯å¢ƒè·¯å¾„ å’Œä½ ä½¿ç”¨çš„sehllæœ‰å…³. 
                æˆ‘ç”¨zsh é‚£ä¹ˆåªè¦åœ¨  ~/.zshrc è¿™ä¸ªæ–‡ä»¶é‡ŒåŠ ä¸‹é¢è¡Œ.ç„¶åé‡å¯shellç”Ÿæ•ˆ.
                export PATH=/opt/puppetlabs/bin:$PATH
                åœ¨æ–‡ä»¶å°¾éƒ¨æ·»åŠ ä¸€è¡Œ æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨echo. å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨viæ·»åŠ .
                ğŸ”… echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.zshrc
                ğŸ‘â€ğŸ—¨ è¿™é‡Œå¿…é¡»ç”¨ å•å¼•å·. å•å¼•å·é‡Œé¢çš„å†…å®¹æ‰ä¼šä¸€æ¨¡ä¸€æ ·çš„è¿½åŠ åˆ°æ–‡ä»¶ä¸­.ä¸ç„¶$PATHè¿™ä¸ªå˜é‡ä¼šå±•å¼€.
                ğŸ‘â€ğŸ—¨ æ·»åŠ å˜é‡åè®°å¾—é‡å¯shell. æœåŠ¡å™¨çš„è¯.æ–­å¼€ssh é‡æ–°è¿å°±å¯ä»¥äº†.

                

â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¤ï¸ FRP å†…ç½‘ç©¿é€è®¾ç½®â¤ï¸ ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
    è§’è‰²           ç³»ç»Ÿ             IPåœ°å€    å®‰è£…è½¯ä»¶           ä¸»æœºå.
    puppet-server  Centos7(è™šæ‹Ÿæœº)  å†…ç½‘IP    puppet-server      VM-C7     
    puppet-agent   Centos6(VPS)     å…¬ç½‘IP    puppwt-agent       mail.0214.help 

è¦ä½¿ç”¨ puppet. å¿…é¡»ä¿è¯ åŒæ–¹èƒ½ç”¨åŸŸåäº’ç›¸è§£æåˆ°. 
å› ä¸º puppet æ˜¯é€šè¿‡  VM-C7 å’Œ mail.0214.help  ä¸»æœºåæ¥äº’ç›¸äº¤æµçš„!

ğŸ”µ å¦‚æœ puppet-server å’Œ puppet-agent éƒ½åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…. æ¯”å¦‚:
    puppet-server çš„IPåœ°å€æ˜¯ 192.168.1.1, ä¸»æœºåæ˜¯ master
    puppet-agent  çš„IPåœ°å€æ˜¯ 192.168.1.2, ä¸»æœºåæ˜¯ client

    é‚£ä¹ˆåŸŸåè§£æéå¸¸ç®€å•.
        åªè¦åœ¨puppet-server çš„hostsæ–‡ä»¶æ·»åŠ ä¸€è¡Œ: 192.168.1.2  client
            æ·»åŠ åä½ å»puppet-server ç”µè„‘å¼€ç»ˆç«¯ ping client å°±æ˜¯ping 192.168.1.2

        åªè¦åœ¨puppet-agent çš„hostsæ–‡ä»¶æ·»åŠ ä¸€è¡Œ: 192.168.1.1  master
            æ·»åŠ åä½ å»puppet-agent ç”µè„‘å¼€ç»ˆç«¯ ping master å°±æ˜¯ping 192.168.1.1

        è¿™å°±æ˜¯åŸŸåè§£æ. ä¹Ÿå°±æ˜¯æŠŠä¸€ä¸ªåå­— å¯¹åº”åˆ°ä¸€ä¸ªIPä¸Š. å°±è¿™ä¹ˆç®€å•.

ğŸ”µ å¦‚æœ puppet-server å’Œ puppet-agent ä¸åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†….æ¯”å¦‚:
    puppet-server çš„å†…ç½‘IPåœ°å€æ˜¯ 192.168.1.1,  ä¸»æœºåæ˜¯ VM-C7
    puppet-agent  çš„å…¬ç½‘IPåœ°å€æ˜¯ 23.105.192.96 ä¸»æœºåæ˜¯ mail.0214.help
    è¦å®ç°äº’ç›¸è§£æå°±éœ€è¦å¯¹ç½‘ç»œ å’Œ puppet æœ‰ç‚¹äº†è§£äº†. éœ€è¦å€ŸåŠ©å†…ç½‘ç©¿é€å·¥å…·.æ¨èç”¨frp. 
    ä¸¤å°puppetè¡¨é¢ä¸Šæ˜¯é€šè¿‡ åŸŸåæ¥äº’ç›¸äº¤æµçš„. å®é™…ä¸Šæ˜¯é€šè¿‡IPæ¥äº’ç›¸äº¤æµçš„.
    ç”¨åŸŸååªæ˜¯ä¸ºäº†æ–¹ä¾¿äººç±»è®°å¿†. å¥½æ¯” å§“åå’Œèº«ä»½è¯å·ç . è‚¯å®šæ˜¯å§“åå®¹æ˜“è®°å•Š..

    å†æ·±å…¥ä¸€ç‚¹. æœåŠ¡å™¨å¯ä»¥åŒæ—¶è¿è¡Œå¾ˆå¤šè½¯ä»¶.ä¸€èˆ¬ä¸€ä¸ªæœåŠ¡å™¨ä¹Ÿå°±ä¸€ä¸ªå¤–ç½‘IP.
    ç”µè„‘ä¸Šçš„æ¯ä¸ªè½¯ä»¶åªç”¨äº†IPçš„å‡ ä¸ªç«¯å£è€Œå·².
    æ¯”å¦‚ç½‘é¡µ:   http çš„80ç«¯å£ã€https çš„443ç«¯å£.
    æ¯”å¦‚puppet: puppet-server çš„8140ç«¯å£. puppet-agent çš„8139ç«¯å£.

    å…¶å® puppet-server å’Œ puppet-agent ä¹‹é—´ç”¨çš„æ˜¯ http åè®®.
    puppet-agent é€šè¿‡ç”µè„‘ä¸Šçš„8139ç«¯å£ å‘æ¶ˆæ¯ç»™ puppet-server ä¸Šçš„8140ç«¯å£.
    æ—¢ç„¶ç«¯å£æ˜¯ç¡®å®šçš„. æˆ‘ä»¬ä¸ç”¨ç®¡.é‚£ä¹ˆæˆ‘ä»¬åªè¦è§£å†³IPé—®é¢˜å°±å¥½äº†. 
    puppet-agent æœåŠ¡å™¨æ˜¯æœ¬èº«å¸¦æœ‰å…¬ç½‘IPçš„. ä»»ä½•ç”µè„‘è¦è§£æåˆ°puppet-agentå¾ˆç®€å•.  è§£æå¯ä»¥ç†è§£æˆè¿æ¥. æ¯”å¦‚sshè¿æ¥.
    puppet-server æ˜¯å†…ç½‘ç”µè„‘.æ²¡æœ‰IPçš„.     ä»»ä½•ç”µè„‘è¦è§£æåˆ°puppet-serverå°±å¾ˆéš¾. ç”¨äº† frpå°±å¾ˆç®€å•!!!
    frp åŸç†è¿™é‡Œä¸è¯´. è‡ªå·±çœ‹ frp.txtå».


ğŸ”µ FRPæœåŠ¡å™¨è®¾ç½® (Centos6 VPS å…¬ç½‘IP: 23.105.192.96)
    vi frps.ini                 âœ ç¼–è¾‘frpæœåŠ¡å™¨é…ç½®æ–‡ä»¶,æ·»åŠ ä¸‹é¢ä¸‰è¡Œ: 
    [vm-centos7-puppetserver]   âœ æ¨¡å—åå­—. åå­—ä»»æ„å–.ä½†æ˜¯å¿…é¡»å’Œfrpå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸­çš„æ¨¡å—åä¸€æ ·.
    auth_token = 123            âœ å¯†ç . æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ äº¤æµè¦å…ˆå¯¹æ¯”å¯†ç çš„. åŒæ–¹å¯†ç ä¸€ç›´æ‰å¯ä»¥æˆåŠŸè¿ä¸ŠæœåŠ¡å™¨.
    listen_port = 8140          âœ è¿™ä¸ªå°±æ˜¯é‡ç‚¹äº†. è¿™ä¸ªæ˜¯frpæœåŠ¡å™¨ç«¯å£.
                                âœ å¦‚æœæœ‰äººè®¿é—®23.105.192.96:8140 é¦–å…ˆæ˜¯è¿æ¥åˆ°frpæœåŠ¡å™¨è¿™å°ç”µè„‘.
                                âœ ç„¶åfrpæœåŠ¡å™¨å°±ä¼šæŠŠè¿™ä¸ªç«¯å£çš„æ‰€æœ‰æ•°æ®è½¬å‘ç»™æˆ‘ä»¬ç­‰ä¸‹å°±å»è®¾ç½®çš„å®¢æˆ·ç«¯.
                                âœ æ–‡ä»¶ç¼–è¾‘å¥½åéœ€è¦é‡å¯frpæœåŠ¡.

    ğŸ”¸ pidof frps                    âœ æ‰¾å‡ºfrpsè¿›ç¨‹: 
    ğŸ”¸ kill xxx                      âœ æ€æ­»frpsè¿›ç¨‹. ä¹Ÿå°±æ˜¯åœæ­¢ç¨‹åºäº†.
    ğŸ”¸ ./frps -c ./frps.ini          âœ æµ‹è¯•å¯åŠ¨. æœ‰é”™è¯¯ä¼šæŠ¥é”™! æ²¡æŠ¥é”™å†ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œåå°é•¿æœŸè¿è¡Œ..
    ğŸ”¸ nohup ./frps -c ./frps.ini &  âœ åå°è¿è¡Œ.æ–­å¼€sshä¹Ÿæ²¡å…³ç³».



ğŸ”µ FRPå®¢æˆ·ç«¯è®¾ç½® (puppet-server Centos7 è™šæ‹Ÿæœº)
    ğŸ”¸ä¸‹è½½å¯¹åº”çš„å®¢æˆ·ç«¯ wget https://github.com/fatedier/frp/releases/download/v0.9.3/frp_0.9.3_linux_386.tar.gz
    ğŸ”¸ è§£å‹æ–‡ä»¶        tar -xzf 
    ğŸ”¸ vi frpc.ini  ç¼–è¾‘frpå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶
    [common]                       âœ åˆ«åŠ¨; è¿æ¥FRPæœåŠ¡å™¨çš„æ¨¡å—åç§°.
    server_addr = 23.105.192.96    âœ ä¿®æ”¹; FRPæœåŠ¡å™¨IP    
    server_port = 7000             âœ ä¸ç®¡; FRPæœåŠ¡å™¨ç«¯å£. 

    auth_token = 123               âœ ä¸ç®¡
    privilege_token = 12345678     âœ ä¸ç®¡

    [vm-centos7-puppetserver]      âœ é‡ç‚¹! è¿™ä¸ªéœ€è¦å’ŒFRPæœåŠ¡å™¨ä¸Šçš„æ¨¡å—åå¯¹åº”.
    local_port = 8140              âœ é‡ç‚¹! ä»»ä½•æ•°æ®è®¿é—®æœåŠ¡å™¨ä¸Šçš„ 8140ç«¯å£ 23.105.192.96:8140 
                                        FRPæœåŠ¡å™¨ å°±ä¼šæŠŠæ•°æ®è½¬å‘åˆ°è¿™å°ç”µè„‘. ä½†æ˜¯è¿™å°ç”µè„‘æœ‰å¾ˆå¤šç«¯å£. 
                                        local_port=8140çš„æ„æ€å°±æ˜¯ è½¬å‘åˆ°8140è¿™ä¸ªç«¯å£
                                        ç°åœ¨åˆ«çš„iFFmpegæŒ‰é’®è¡¨é¢ä¸Šæ˜¯è®¿é—®çš„ 23.105.192.96:8140 
                                        å…¶å®ç»è¿‡frpæœåŠ¡å™¨åœ¨ä¸­è½¬å å®é™…å°±å˜æˆäº†è®¿é—® puppet-serverçš„8140ç«¯å£äº†.
                                        ä¹Ÿå°±æ˜¯åˆ«çš„ç”µè„‘æƒ³è¦è¿æ¥åˆ° pupper-server.
    ğŸ”¸nohup ./frpc -c ./frpc.ini &  âœ åå°å¯åŠ¨frp å®¢æˆ·ç«¯





â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸ åŸŸåè§£æ â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸

ğŸ”¸ å…³é—­ SELINUX
    Security-Enhanced Linuxçš„ç¼©å†™ï¼Œæ˜¯ä¸€ç§éå¸¸å®‰å…¨çš„LINUXæ¨¡å¼ã€‚
    åŸºæœ¬ä¸Šç”¨æˆ·å¾—ä¸åˆ°ä»€ä¹ˆæƒé™åœ¨è¿™ä¸ªç³»ç»Ÿä¸‹é¢ã€‚
    ğŸ”…  /usr/sbin/sestatus -v                     âœ æŸ¥çœ‹å½“å‰SELINUXçŠ¶æ€. 
        vi /etc/selinux/config                    âœ ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶æ¥æ°¸ä¹…å…³é—­SELINUX
        å°†SELINUX=enforcingæ”¹ä¸ºSELINUX=disabled   âœ ä¿®æ”¹åé‡å¯ç”µè„‘.


ğŸ”¸ æ–°æ‰‹å…³é—­é˜²ç«å¢™.

ğŸ”¸ æ—¶é—´è®¾ç½®
       Puppetçš„masterèŠ‚ç‚¹çš„æ—¶é—´å¿…é¡»è®¾ç½®å‡†ç¡®ï¼Œå› ä¸ºä»–å°†ç”¨äºè¯ä¹¦ç­¾å‘.å°½å¯èƒ½çš„ä½¿ç”¨NTP.

ğŸ”¸Cent0s7 æ›´æ”¹ä¸»æœºå:
        hostname                                      âœ æŸ¥çœ‹å½“å‰ä¸»æœºå.
        sudo hostnamectl --static set-hostname VM-C7  âœ æ°¸ä¹…æ›´æ”¹ä¸»æœºåæˆVM-C7


ğŸ”¸puppet-agentåŸŸåè§£æ
    vi /etc/hosts         
    23.105.192.96 VM-C7 âœ  æ·»åŠ è¿™è¡Œå°±å¯ä»¥äº†. ä½ ä¸ç”¨ç®¡ç«¯å£çš„ 
                        âœ è¿™ä¸ªç”µè„‘è¿è¡Œçš„æ˜¯puppet-agent é‚£ä¹ˆå®ƒè‚¯å®šæ˜¯å»è¿æ¥æœåŠ¡å™¨çš„.è‚¯å®šæ˜¯å»è¿æ¥8140ç«¯å£çš„.
                        âœ 23.105.192.96:8140 ç«¯å£çš„æ‰€æœ‰æ•°æ®.éƒ½ä¼šè¢«frpæœåŠ¡å™¨.è½¬ä¸ªpuppet-serverçš„8140ç«¯å£.

ğŸ”¸ ç¼–è¾‘puppet-agenté…ç½®æ–‡ä»¶. åœ¨[agent]æ¨¡å—ä¸‹æ·»åŠ ä¸‹é¢ä¸€è¡Œ.
    vi /etc/puppetlabs/puppet/puppet.conf
    server = VM-C7      âœ è¿™ä¸ªå°±æ˜¯ä½ è¦è¿æ¥çš„ puppet-server çš„ä¸»æœºå/åŸŸå
                        âœ puppet-agent æ˜¯è¿åˆ°å«è¿™ä¸ªåå­—çš„æœåŠ¡å™¨ä¸Šçš„. 
                        âœ è¿™ä¸ªåå­—å¯¹åº”çš„ip å°±æ˜¯æˆ‘ä»¬hostsæ–‡ä»¶é‡Œæ·»åŠ çš„dnsè§£æ

ğŸ”¸ puppet-agent è¿æ¥æœåŠ¡å™¨æµ‹è¯•
    ğŸ”… puppet agent --test
    Info: Creating a new SSL key for mail.0214.help

    puppet ä¸ºäº†ä¿¡æ¯å®‰å…¨. åŒæ–¹é‡‡ç”¨äº†SSLåè®®. ä¹Ÿå°±æ˜¯https. éœ€è¦ç”¨åˆ°è¯ä¹¦!
    å®¢æˆ·ç«¯è¿è¡Œ å°±è‡ªåŠ¨ä¼šå‘æœåŠ¡å™¨ç”³è¯·å»ºç«‹è¿æ¥. 
    è¿™æ—¶å€™è¦å»æœåŠ¡å™¨åŒæ„å®¢æˆ·ç«¯çš„è¿æ¥.å®¢æˆ·ç«¯æ‰èƒ½çœŸæ­£è¿ä¸ŠæœåŠ¡å™¨.
    åŒæ„è¿æ¥è¿™ä¸ªæ“ä½œå°±å«ç­¾å.
    æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å°±ä¼šé•¿æœŸä¿æŒé€šä¿¡(å®¢æˆ·ç«¯æ¯åŠå°æ—¶è¿ä¸€æ¬¡æœåŠ¡å™¨)!!!


ğŸ”¸ puppet-server æœåŠ¡å™¨æŸ¥çœ‹å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚
    ğŸ”…puppet cert list
      "mail.0214.help" (SHA256) 6E:3F:48:F6:F1:52:18:30:F8:DD:2F:D3:7E:BA:C1:2E:1E:89:8A:0D:37:96:DF:E3:F5:79:A0:7F:85:5C:28:97
      å‡ºç°ä¸€ä¸ª å‰é¢æ²¡å¸¦åŠ å·çš„ å°±è¯´æ˜æœ‰å®¢æˆ·ç«¯æƒ³è¦è¿æœåŠ¡å™¨.å¦‚æœä½ åŒæ„å¯¹æ–¹è¿æ¥ å°±éœ€è¦ç­¾å.

ğŸ”¸ puppet-server å¯¹å®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œç­¾å
    ğŸ”…puppet cert sign mail.0214.help
    Signing Certificate Request for:
    "mail.0214.help" (SHA256) 6E:3F:48:F6:F1:52:18:30:F8:DD:2F:D3:7E:BA:C1:2E:1E:89:8A:0D:37:96:DF:E3:F5:79:A0:7F:85:5C:28:97
    Notice: Signed certificate request for mail.0214.help
    Notice: Removing file Puppet::SSL::CertificateRequest mail.0214.help at '/etc/puppetlabs/puppet/ssl/ca/requests/mail.0214.help.pem'


ğŸ”¸puppet-server æŸ¥çœ‹æ‰€æœ‰è¯ä¹¦
    ğŸ”…requests puppet cert list -all
    + "mail.0214.help" (SHA256) 4D:01:04:D7:4B:C8:75:D6:C2:D5:63:BA:93:46:C2:E1:D9:82:D6:97:AA:AC:A8:50:69:9F:6A:A8:67:27:67:F2
    + "mail.0214.live" (SHA256) D3:D7:DB:74:E6:53:CC:0F:EE:55:83:5E:65:A5:9B:32:4B:D6:9F:E5:DA:D1:50:67:88:31:3C:44:EE:C0:EE:92

ğŸ”¸puppet-server å¤±æ•ˆæŸè¯ä¹¦  puppet cert --revoke mail.0214.live
ğŸ”¸puppet-server åˆ é™¤æŸè¯ä¹¦  puppet cert --clean mail.0214.live
    â—ï¸â—ï¸è¯ä¹¦ç­¾åçš„è¿‡æœŸæˆ–åˆ é™¤éœ€è¦é‡å¯puppetmasteræœåŠ¡ã€‚â—ï¸â—ï¸
    sudo systemctl restart puppetserver

ğŸ”¸puppet-agent è¿æ¥è®¾ç½®.
    âœ  puppet puppet agent --test
    Error: Could not request certificate: The certificate retrieved from the master does not match the agent's private key.
    Certificate fingerprint: 4D:01:04:D7:4B:C8:75:D6:C2:D5:63:BA:93:46:C2:E1:D9:82:D6:97:AA:AC:A8:50:69:9F:6A:A8:67:27:67:F2
    To fix this, remove the certificate from both the master and the agent and then start a puppet run, which will automatically regenerate a certificate.
    On the master:
    puppet cert clean mail.0214.help
    On the agent:
    1a. On most platforms: find /etc/puppetlabs/puppet/ssl -name mail.0214.help.pem -delete
    1b. On Windows: del "\etc\puppetlabs\puppet\ssl\certs\mail.0214.help.pem" /f
    2. puppet agent -t


    ğŸ“Œå¦‚æœå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨å‡ºé—®é¢˜. 
    ğŸ“Œ 1. é¦–å…ˆæ’é™¤frpé—®é¢˜. çœ‹frps/frpc æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
    ğŸ“Œ 2. è¿›è¡Œä¸‹é¢çš„æ­¥éª¤
    ğŸ“Œè¿˜ä¸è¡Œå°±é‡è£…å®¢æˆ·ç«¯.   è¿˜ä¸è¡Œå°±é‡è£…æœåŠ¡å™¨.  å†ä¸è¡Œå°±è‡ªå·±åˆ†æé—®é¢˜åŸå› äº†.
    1. å®¢æˆ·ç«¯: rm -rf /etc/puppetlabs/puppet/ssl/*     åˆ é™¤sslæ–‡ä»¶å¤¹æ‰€æœ‰å†…å®¹. ä¸è¦åªåˆ é™¤æŸä¸ªæ–‡ä»¶.
    3. æœåŠ¡å™¨: puppet cert clean mail.0214.help        åˆ é™¤è¯ä¹¦. 
    4. æœåŠ¡å™¨ï¸:ï¸ puppetserver reload ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸       åˆ é™¤/å¤±æ•ˆæŸè¯ä¹¦åå¿…é¡»é‡å¯æœåŠ¡å™¨
    5. å®¢æˆ·ç«¯: puppet agent --test                     é‡æ–°ç”³è¯·è¯ä¹¦.
    6. æœåŠ¡å™¨: puppet cert list                        åˆ—å‡ºå®¢æˆ·ç«¯çš„è¯·æ±‚
    7. æœåŠ¡å™¨: puppet cert sign mail.0214.help         å¯¹mail.0214.help è¿™å®¢æˆ·ç«¯è¿›è¡Œç­¾å.
    8. å®¢æˆ·ç«¯: puppet agent --test                     é‡æ–°è¯·æ±‚è¿æ¥.
        ğŸ‘¹ Info: Caching certificate for mail.0214.help
        Error: Could not request certificate: 
        Server hostname 'VM-C7' did not match server certificate; 
        expected one of localhost.localdomain, DNS:puppet, DNS:localhost.localdomain
        Exiting; failed to retrieve certificate and waitforcert is disabled
            åˆæŠ¥é”™äº†...  æœåŠ¡å™¨çš„åå­— å’ŒæœåŠ¡å™¨çš„è¯ä¹¦ä¸æœ.
            é—®é¢˜å‡ºåœ¨æœåŠ¡å™¨. å…¶å®æœåŠ¡å™¨æ˜¯æ”¹è¿‡ä¸»æœºåå­—çš„. 
            åŸæ¥åå­—æ˜¯ localhost.localdomain å®‰è£…å¥½puppetserveråæ”¹æˆVM-C7äº†.
            å…¶å®puppetserver å®‰è£…çš„æ—¶å€™æ˜¯éœ€è¦ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦çš„! ç”Ÿæˆè¯ä¹¦è‚¯å®šç”¨åˆ°ä¸»æœºåçš„. 
            è¿™æ—¶å€™ç”¨çš„ä¸»æœºåæ˜¯localhost.localdomain.  å¯¹åº”æœåŠ¡å™¨è¯ä¹¦ä¸Šçš„ä¸»æœºåæ˜¯localhost.localdomain
            ğŸ”¸è§£å†³æ–¹æ³•ä¸€: å¸è½½é‡è£….puppet-server

            ğŸ”¸è§£å†³æ–¹æ³•äºŒ: å®¢æˆ·ç«¯: æ·»åŠ å‚æ•°. --server 
                âœ  ~ puppet agent --test --server localhost.localdomain
                Info: Caching certificate_revocation_list for ca
                Info: Using configured environment 'production'
                Info: Retrieving pluginfacts
                Info: Retrieving plugin
                Info: Caching catalog for mail.0214.help
                Info: Applying configuration version '1492656142'
                Info: Creating state file /opt/puppetlabs/puppet/cache/state/state.yaml

            ğŸ”¸è§£å†³æ–¹æ³•ä¸‰: 
                ç¼–è¾‘å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ [anent] ä¸‹é¢çš„server name æ”¹æ‰
                vi /etc/puppetlabs/puppet/puppet.conf
                server = localhost.localdomain

                è¿˜è¦æ·»åŠ  ä¸€æ¡åŸŸåè§£æ..
                vi /etc/hosts
                23.105.192.96 localhost.localdomain

                âœ  puppet puppet agent -t
                Info: Using configured environment 'production'
                Info: Retrieving pluginfacts
                Info: Retrieving plugin
                Info: Caching catalog for mail.0214.help
                Info: Applying configuration version '1492656538'
                Notice: Applied catalog in 0.02 seconds




â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
é¦–å…ˆ ä½ å¾—å¤§æ¦‚çŸ¥é“puppet æœ‰å¤šå°‘å­å‘½ä»¤. æ¯ä¸ªpuppet å­å‘½ä»¤åˆæœ‰å“ªäº›action..
âœ˜âœ˜âˆ™ğ’— pp puppet help

Usage: puppet <subcommand> [options] <action> [options]

Available subcommands:

  agent             The puppet agent daemon
  apply             Apply Puppet manifests locally
                    âœ åœ¨å®¢æˆ·ç«¯æœ¬åœ°è¿è¡Œxx.pp 

  cert              Manage certificates and requests
                    âœ è¯ä¹¦ç›¸å…³å‘½ä»¤.

  config            Interact with Puppet's settings.
 
  facts             Retrieve and store facts.

  lookup            Data in modules lookup function

  master            The puppet master daemon
  module            Creates, installs and searches for modules on the Puppet Forge.

  node              View and manage node definitions.
  parser            Interact directly with the parser.
  plugin            Interact with the Puppet plugin system.









ğŸ”µ puppet apply 

puppet agent å®¢æˆ·ç«¯é»˜è®¤éƒ½æ˜¯ä»æœåŠ¡å™¨ä¸‹è½½é…ç½®æ–‡ä»¶.ç„¶åå†æ‰§è¡Œè¿™ä¸ªé…ç½®æ–‡ä»¶.
puppet apply å®¢æˆ·ç«¯å½“ç„¶ä¹Ÿå¯ä»¥ä¸ä»æœåŠ¡å™¨ä¸‹è½½.è€Œæ˜¯ç›´æ¥è¿è¡Œæœ¬åœ°çš„é…ç½®æ–‡ä»¶.

ğŸ”¸é…ç½®æ–‡ä»¶:
config.pp
class puppet::config{
  include puppet::params
  file { '/etc/puppet/puppet.conf':
    ensure  => present,
    content => template('puppet/puppet.conf.erb'),
    owner   => 'root',
    group   => 'root',
    mode    => '0644',
    require => Class['puppet::install'],
    notify  => Class['puppet::service'],  #é…ç½®æ›´æ–°åä¸»åŠ¨é€šè¿‡puppetæœåŠ¡é‡å¯
  }
}

ğŸ”¸ æ¨¡æ‹Ÿæ‰§è¡Œè¿™ä¸ªé…ç½®æ–‡ä»¶.
âœ˜âœ˜âˆ™ğ’— pp puppet apply config.pp --noop --verbose


















â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ GCE(CentOS7_x64) puppet-server ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ
â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”¸ å…¶ä»–è®¾ç½®

    â¦¿ CentOS æ›´æ”¹ä¸»æœºå:
        hostname                                      âœ æŸ¥çœ‹å½“å‰ä¸»æœºå.
        sudo hostnamectl --static set-hostname gce    âœ æ°¸ä¹…æ›´æ”¹ä¸»æœºåæˆgce


ğŸ”¸ å®‰è£…&é…ç½®

    â¦¿ puppetå®˜æ–¹yumæº: 
        https://yum.puppetlabs.com/
    â¦¿ Centos6 æ·»åŠ puppet çš„å®˜æ–¹yumæº.
        rpm -ivh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-6.noarch.rpm
    â¦¿ Centos7 æ·»åŠ puppet çš„å®˜æ–¹yumæº.
        rpm -ivh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-7.noarch.rpm
        ğŸ‘â€ğŸ—¨ åªè¦é€‰ä¸€ä¸ª.  æ ¹æ®centos ç‰ˆæœ¬é€‰å°±å¯ä»¥äº†

    â¦¿ å®‰è£…rubyç¯å¢ƒ             yum install ruby ruby-rdoc -y
    â¦¿ å®‰è£… puppet-server       yum install puppetserver -y

    â¦¿ é…ç½®ç¯å¢ƒè·¯å¾„(zsh)        echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.zshrc
    â¦¿ é…ç½®ç¯å¢ƒè·¯å¾„(bash)       echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.bash_profile
    â¦¿ é‡æ–°åŠ è½½ zsh é…ç½®æ–‡ä»¶    source ~/.zshrc

    â¦¿ æŸ¥çœ‹ puppet agent ç‰ˆæœ¬   puppet agent -V

    â¦¿ â—ï¸ä¿®æ”¹å†…å­˜è¦æ±‚(æœåŠ¡ç«¯)â—ï¸    
        é»˜è®¤æœ€ä½2Gçš„å†…å­˜. ä¸ç„¶å°±å¯åŠ¨ä¸äº†! åªèƒ½æ‰‹åŠ¨ä¿®æ”¹å†…å­˜è¦æ±‚.
        éšä¾¿ä½ æ”¹. å¯ä»¥æ˜¯256m ä¹Ÿå¯ä»¥æ˜¯1g. å»ºè®®åˆ†é…å¤šç‚¹..
        vi /etc/sysconfig/puppetserver 
            JAVA_ARGS="-Xms2g -Xmx2g"  âœ JAVA_ARGS="-Xms256m -Xmx256m"
            JAVA_ARGS="-Xms2g -Xmx2g"  âœ JAVA_ARGS="-Xms1g -Xmx1g"

    â¦¿ æŸ¥çœ‹puppetserver è¿è¡ŒçŠ¶æ€     systemctl status puppetserver
    â¦¿ å¯åŠ¨puppet-server             sudo systemctl start puppetserver
    â¦¿ å¼€æœºå¯åŠ¨                      sudo systemctl enable puppetserver

    â¦¿ åˆ¤æ–­ puppet-server 8140ç«¯å£æ˜¯å¦å¼€å¯
        netstat -nlatp | grep 8140
        nmap -p 8140 127.0.0.1 






â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ VPS2 (CentOS7_x64) puppet-agent  ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ
â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
â—ï¸â—ï¸åŸŸåè®¾ç½®.  ä¸»æœºåå­—ä¸é‡è¦! åªè¦èƒ½è§£æåˆ° æœåŠ¡å™¨çš„IPå°±è¡Œ.â—ï¸â—ï¸
æ¯”å¦‚æœåŠ¡å™¨çš„IPæ˜¯ 104.224.139.45
www.0214.live å’Œ ss.0214.live éƒ½æ˜¯æŒ‡å‘ 104.224.139.45çš„.
é‚£ä¹ˆ ä¸»æœºå. é€‰æ‹©www.0214.live æˆ–è€… ss.0214.live éƒ½å¯ä»¥.






ğŸ”¸ å…¶ä»–è®¾ç½®

    â¦¿ CentOS æ›´æ”¹ä¸»æœºå:
        hostname                                      âœ æŸ¥çœ‹å½“å‰ä¸»æœºå.
        sudo hostnamectl --static set-hostname VPS2   âœ æ°¸ä¹…æ›´æ”¹ä¸»æœºåæˆvps2

        ğŸ‘¹ Warning: Server hostname 'gce' did not match server certificate; expected one of gce.c.cloudpan-172312.internal, DNS:puppet, DNS:gce.c.cloudpan-172312.internal
        ç”¨gceçš„æœåŠ¡å™¨è¦æ³¨æ„äº†.   gce æœåŠ¡å™¨çš„ä¸»æœºå ä¸æ˜¯ hostname æŸ¥è¯¢å‡ºæ¥çš„ä¸»æœºå.
        è€Œæ˜¯ç±»ä¼¼ è¿™æ ·çš„æ ¼å¼. gce.c.cloudpan-172312.internal


        ğŸ‘¹ å¸®ç“¦å·¥ vps
        æ”¹åç›´æ¥å»æ§åˆ¶é¢æ¿æ”¹.




ğŸ”¸ å®‰è£…&é…ç½®


    â¦¿ Centos7 æ·»åŠ puppet çš„å®˜æ–¹yumæº.
        rpm -ivh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-7.noarch.rpm

    â¦¿ å®‰è£… puppet-agent     sudo yum -y install puppet-agent

    â¦¿ é…ç½®ç¯å¢ƒè·¯å¾„(zsh)        echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.zshrc
    â¦¿ é…ç½®ç¯å¢ƒè·¯å¾„(bash)       echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.bash_profile
    â¦¿ é‡æ–°åŠ è½½ zsh é…ç½®æ–‡ä»¶    source ~/.zshrc

    â¦¿ æŸ¥çœ‹ puppet agent ç‰ˆæœ¬   puppet agent -V

    â¦¿ å¼€å¯å®¢æˆ·ç«¯: 
        sudo /opt/puppetlabs/bin/puppet resource service puppet ensure=running enable=true


    â¦¿ åŸŸåè§£æ
        vi /etc/hosts 
        35.194.128.92 gce.c.cloudpan-172312.internal

    â¦¿ ç¼–è¾‘puppet-agenté…ç½®æ–‡ä»¶. 
        vi /etc/puppetlabs/puppet/puppet.conf  åœ¨æ·»åŠ ä¸‹é¢ä¸¤è¡Œ.

        [agent]
        server = gce.c.cloudpan-172312.internal


ğŸ”¸ puppet-agent è¿æ¥æµ‹è¯•
    puppet agent --test


    å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¿æ¥æœåŠ¡å™¨è¦å…ˆè·å¾—æœåŠ¡å™¨çš„å…è®¸åæ‰èƒ½è¿æ¥æœåŠ¡å™¨.
    è¦å»æœåŠ¡å™¨åŒæ„å…ˆ.


    å®‰è£…è¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œä¸»è¦éƒ½æ˜¯DNSå¯¼è‡´ã€‚
    ä¸€å¼€å§‹ ç›´æ¥ç”¨hosts æ¥é…ç½®æ˜¯æœ€ç®€ä¾¿çš„ï¼ŒæŠŠserverçš„ipæŒ‡å®šä¸ºpuppetåŸŸå

    âœ˜âœ˜âˆ™ğ’—2 ~ âœ puppet agent --test
    Info: Caching certificate_revocation_list for ca
    Info: Using configured environment 'production'
    Info: Retrieving pluginfacts
    Info: Retrieving plugin
    Info: Caching catalog for vps2.localdomain
    Info: Applying configuration version '1500102434'
    Notice: Applied catalog in 0.03 seconds






â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ é‡ç½® ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ
â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸




â¦¿ åŒæ–¹åˆ é™¤è¯ä¹¦
    â€¢ å®¢æˆ·ç«¯: rm -rf /etc/puppetlabs/puppet/ssl     åˆ é™¤sslæ–‡ä»¶å¤¹æ‰€æœ‰å†…å®¹
        
    â€¢ æœåŠ¡å™¨: 
        puppet cert list                            æ˜¾ç¤ºæœªç­¾åè¯ä¹¦.
        puppet cert list --all                      æ˜¾ç¤ºæ‰€æœ‰è¯ä¹¦.
        puppet cert clean vps2.localdomain          åˆ é™¤å¯¹åº”è¯ä¹¦. 
        puppetserver reload ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸           åˆ é™¤/å¤±æ•ˆæŸè¯ä¹¦åå¿…é¡»é‡å¯æœåŠ¡å™¨

    â€¢ å®¢æˆ·ç«¯: puppet agent --test                   é‡æ–°ç”³è¯·è¯ä¹¦.
    
    â€¢ æœåŠ¡å™¨: puppet cert list                      åˆ—å‡ºå®¢æˆ·ç«¯çš„è¯·æ±‚
    â€¢ æœåŠ¡å™¨: puppet cert sign vps2.localdomain     å¯¹mail.0214.help è¿™å®¢æˆ·ç«¯è¿›è¡Œç­¾å.
    
    â€¢ å®¢æˆ·ç«¯: puppet agent --test                   é‡æ–°è¯·æ±‚è¿æ¥.




Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Permission denied - /opt/puppetlabs/server/data/puppetserver/yaml/facts/vps2.localdomain.yaml20170716-16059-lvojb3.lock



âœ˜âœ˜âˆ™GCE manifests âœ cd /opt/puppetlabs/server/data/puppetserver/yaml/facts/
âœ˜âœ˜âˆ™GCE facts âœ ls
total 8
-rw-rw---- 1 root root 8016 Jul 15 16:49 vps2.localdomain.yaml
âœ˜âœ˜âˆ™GCE facts âœ
âœ˜âœ˜âˆ™GCE facts âœ rm vps2.localdomain.yaml

â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ ä½¿ç”¨ ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ
â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ç»è¿‡åƒè¾›ä¸‡è‹¦å®¢æˆ·ç«¯ç»ˆäºæˆåŠŸè¿ä¸ŠæœåŠ¡å™¨äº†.ç¯å¢ƒç®—æ­å¥½äº†.æˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆç”¨.

Puppet å¯ä»¥å•æœºä½¿ç”¨(æµ‹è¯•ç”¨). ä¸€èˆ¬éƒ½æ˜¯å¤šæœºå™¨ä½¿ç”¨

    ğŸ“Œ Puppet ä¸¤ç§æ‰§è¡Œæ¨¡å¼:
        ç›´æ¥è¯»å–puppet file.manifesté…ç½®
        é€šè¿‡puppetd --server puppetmaster.server.comï¼Œä»æœåŠ¡ç«¯ä¸‹è½½manifesté…ç½®








æœåŠ¡å™¨åªæœ‰ä¸€å°. å®¢æˆ·ç«¯å¯ä»¥æœ‰åƒä¸‡å°. 
æ‰€æœ‰å®¢æˆ·ç«¯ éƒ½å…ˆæŸ¥çœ‹ site.pp è¿™ä¸ªæ€»çš„é…ç½®æ–‡ä»¶.
è¿™ä¸ªé…ç½®æ–‡ä»¶é‡Œ å¯ä»¥ç»™æ¯ä¸ªå®¢æˆ·ç«¯è¿›è¡Œä¸åŒçš„é…ç½®.


ğŸ”¸ ä½œç”¨.
    å¯ä»¥åœ¨å®¢æˆ·ç«¯è¿è¡Œå‘½ä»¤ã€è¿è¡Œè„šæœ¬ ç­‰ç­‰æ“ä½œ.

å¦‚ åˆ›å»ºä¸€ä¸ª xuç”¨æˆ·.
user{'11':
    name => xu,
    ensure => present,
}






ğŸ”¸ èŠ‚ç‚¹
    åŸŸååªè¦ å®¢æˆ·ç«¯ping æœåŠ¡å™¨å. èƒ½æ­£ç¡®è§£æåˆ°æœåŠ¡å™¨ipå°±å¯ä»¥.
    

    vps2. 104.224.139.45

    gce.c.cloudpan-172312.internal

    vps2.localdomain
    vps2.localdomain



ğŸ”¸ site.pp 
    å°±æ˜¯èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ï¼Œé‡Œé¢å¯ä»¥åŒ…å«å¯¹å„ä¸ªèŠ‚ç‚¹çš„é…ç½®æè¿°ã€‚
    åœ¨å®ä¾‹é…ç½®æ–‡ä»¶ä¸­ï¼Œâ€puppetagentâ€å°±æ˜¯èŠ‚ç‚¹çš„ä¸»æœºåã€‚
    åŒ…å«åœ¨ puppetagent ä¸­çš„é…ç½®æè¿°å°±æ˜¯è¯¥èŠ‚ç‚¹çš„èµ„æºé›†åˆçš„æè¿°ã€‚

é»˜è®¤åœ¨æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤.


æŒ‡å®šèŠ‚ç‚¹è¿è¡Œç‰¹å®šå‘½ä»¤: 
node 'mail.0214.help'{
  include  motd
}


node slave01 {
  file {
    "/tmp/testpuppet": #åœ¨slaveèŠ‚ç‚¹ä¸Šåˆ›å»ºè¯¥æ–‡ä»¶
    content=>"good morning!\n"; #æ–‡ä»¶ä¸­æ‰“å°å¦‚ä¸‹å†…å®¹
  }
}







ğŸ”¸ ç¬¬ä¸€ä¸ªé…ç½®æ–‡ä»¶. âœ”ï¸
    åœ¨å®¢æˆ·ç«¯æ–°å»ºä¸€ä¸ªæ–‡ä»¶.å¹¶å†™å…¥å†…å®¹.

    â€¢ æœåŠ¡å™¨
        vi /etc/puppetlabs/code/environments/production/manifests/site.pp
        
    file { 'helloworld':

        path => '/etc/helloworld.txt',
        owner  => 'root',
        group  => 'root',
        mode   => '655',
        content => "hello world from puppet!\n",
        }

    â€¢ å®¢æˆ·ç«¯
        âœ˜âœ˜âˆ™ğ’—2 ~ âœ puppet agent --test

        ç„¶åå°±å¤šäº†ä¸ªæ–‡ä»¶å‡ºæ¥äº†
        âœ˜âœ˜âˆ™ğ’—2 ~ âœ cat /etc/helloworld.txt
        hello world from puppet!







ğŸ”¸ æ‰§è¡Œè„šæœ¬.
    ä½œä¸ºè¿›é˜¶çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›èŠ‚ç‚¹å¯ä»¥æ‰§è¡Œä¸€äº›æ›´åŠ å¤æ‚ä¸€ç‚¹çš„ä»»åŠ¡ã€‚
    æˆ‘ä»¬å¸Œæœ›èŠ‚ç‚¹å¯ä»¥ä» PuppetServer è·å–ä¸€ä¸ªå‘½ä»¤è„šæœ¬ï¼Œå¹¶ä¸”æ‰§è¡Œè¯¥è„šæœ¬ã€‚

    â€¢ åˆ›å»ºä¸€ä¸ªåå«â€testâ€çš„æ¨¡å—æ–‡ä»¶å¤¹
        mkdir /etc/puppetlabs/code/environments/production/modules/test

    â€¢ åœ¨ test æ¨¡å—ä¸‹é¢åˆ›å»ºä¸€ä¸ªâ€filesâ€æ–‡ä»¶å¤¹ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶æ˜¯å¯ä»¥è¢«èŠ‚ç‚¹è·å–çš„ã€‚
        mkdir /etc/puppetlabs/code/environments/production/modules/test/files

    â€¢ åœ¨â€filesâ€æ–‡ä»¶å¤¹é‡Œåˆ›å»ºä¸€ä¸ª shell è„šæœ¬ test.sh
        è¯¥è„šæœ¬ä¼šåœ¨/etc/ç›®å½•ä¸‹åˆ›å»º helloworld.log æ–‡ä»¶ï¼Œç„¶ååœ¨æ–‡ä»¶é‡Œæ·»åŠ â€hello worldâ€å†…å®¹ã€‚

        vi /etc/puppetlabs/code/environments/production/modules/test/files/test.sh
        è„šæœ¬å†…å®¹
    touch /etc/helloworld.log
    echo "helloworld" >> /etc/helloworld.log

    â€¢ ç¼–è¾‘ site.pp
        æˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªèµ„æºï¼šä¸€ä¸ªæ–‡ä»¶èµ„æºå’Œä¸€ä¸ªæ‰§è¡Œå‘½ä»¤èµ„æºã€‚
        è¿™ä¸¤ä¸ªèµ„æºæœ‰ä¾èµ–å…³ç³»ï¼Œå‘½ä»¤æ‰§è¡Œèµ„æºä¾èµ–äºæ–‡ä»¶èµ„æºï¼Œæ‰€ä»¥ Puppet ä¼šä¼˜å…ˆå¤„ç†æ–‡ä»¶èµ„æºã€‚
        æ‰§è¡Œå‘½ä»¤èµ„æºä¼šåœ¨æ–‡ä»¶èµ„æºå­˜åœ¨åå†æ‰§è¡Œã€‚

        vi /etc/puppetlabs/code/environments/production/manifests/site.pp


    file { 'test.sh':
    path => '/etc/test.sh',
    owner  => 'root',
    group  => 'root',
    mode   => '655',
    source => 'puppet:///modules/test/test.sh',
    }
    exec { 'execute ':
    command => 'bash /etc/test.sh',
    require => File['test.sh'],
    path => ["/bin/"],
    }


    â€¢ å®¢æˆ·ç«¯
        puppet agent --test

            Info: Using configured environment 'production'
            Info: Retrieving pluginfacts
            Info: Retrieving plugin
            Info: Caching catalog for vps2.localdomain
            Info: Applying configuration version '1500166128'
            Notice: /Stage[main]/Main/File[test.sh]/ensure: defined content as '{md5}4a7fef6d906b79559966eef350f380a6'
            Notice: /Stage[main]/Main/Exec[execute ]/returns: executed successfully
            Notice: Applied catalog in 0.41 seconds

    â€¢ å®¢æˆ·ç«¯æ£€æµ‹
        cat /etc/helloworld.log
        å‡ºç° helloworld












ğŸ”¸ å¸¸ç”¨é…ç½®å‘½ä»¤

node default {
    cron {
        "check raid":
        command => "/usr/local/scripts/check_raid.sh",
        user    => root,
        hour    => '*',
        minute  => '*/5',
        ensure  => present;

        "add puppet cron":
        command => "/usr/bin/puppet agent --server puppet.server.com",
        user    => root,
        minute  => [0,30];
    }

    exec {
        "generate timestamp file":
        command => "date +%s > timestamp.file",
        path    => "/usr/bin:/usr/sbin:/bin",
        onlyif  => "test -f timestamp.file",
        cwd     => "/tmp";
    }

    file {
        "pp_test.txt":
        path    => "/tmp/pp_test.txt",
        ensure  => present,
        content => "Just do a puppet test!",
        mode    => 0644;
    }

    host {
        "add repo":
        ensure  => present,
        name    => "yum.puppet.com",
        ip      => "192.168.1.15",
        host_aliases => ["repo.puppet.com", "r.puppet.com"];
    }

    mount {
        "mount to /mnt":
        atboot  => true,
        ensure  => present,
        device  =>  "/dev/vdb",
        name    => "/mnt",
        fstype  => "ext4",
        options => "defaults";
    }

    package {
        "httpd":
        name    => "httpd.x86_64",
        ensure  => installed;
    }

    ssh_authorized_key {
        "zhiwei's key":
        ensure  => present,
        name    => "zhiwei's ssh rsa key",
        key     => "a long hex sting in ~/.ssh/id_rsa.pub",
        type    => rsa,
        user    => root;
    }

    tidy {
        "remove tmp file":
        age     => "1w",
        recurse => true,
        matches => ["[0-9a-z]*.tmp", "*.swap"];
    }

    user {
        "add zhiwei":
        ensure  => present,
        home    => "/home/zhiwei",
        name    => zhiwei,
        password=> 123456,
        shell   => /bin/bash,
        managehome=>true;
    }

    yumrepo {
        "private repo":
        name    => "plus",
        descr   => "Plus private repo",
        baseurl => "http://private.puppet.com",
        enabled => 1,
        timeout => 5;
    }
}