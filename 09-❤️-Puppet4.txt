ğŸ”µ ç®€ä»‹
                                  â¤ï¸â¤ï¸ï¸â¤ï¸ Puppet æå“å…¥é—¨æ•™ç¨‹ â¤ï¸â¤ï¸â¤ï¸
     http://www.zsythink.net/archives/category/%E8%BF%90%E7%BB%B4%E7%9B%B8%E5%85%B3/puppet/

                â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸å®‰è£…puppet-server ä¼šè‡ªåŠ¨å®‰è£… puppet-agent.â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸
                â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸å®‰è£…puppet-server ä¼šè‡ªåŠ¨å®‰è£… puppet-agent.â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸
                          ä¸ç®¡ä»€ä¹ˆç”µè„‘è¦ç”¨puppetå®‰è£… puppet-server å°±å¯¹äº†.
                                puppet-server æœ‰å¾ˆå¤šç‰ˆæœ¬ æœ€æ–°æ˜¯ 4.10
                                puppet-agent  æœ‰å¾ˆå¤šç‰ˆæœ¬ æœ€æ–°æ˜¯ 1.10
                        æœ€æ–°ç‰ˆçš„puppet-server æœ€å¥½è¿æ¥æœ€æ–°ç‰ˆçš„ puppet-agent
                        é«˜ç‰ˆæœ¬çš„puppet-server å¯ä»¥è¿æ¥ä½ç‰ˆæœ¬çš„ puppet-agent
                        ä½ç‰ˆæœ¬çš„puppet-server ä¸èƒ½è¿æ¥é«˜ç‰ˆæœ¬çš„ puppet-agent
                           æ‰€ä»¥: æœåŠ¡å™¨å°½é‡å®‰è£…æœ€æ–°ç‰ˆæœ¬. å®¢æˆ·ç«¯ç›¸å¯¹æ— æ‰€è°“.

               â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸puppetå®˜æ–¹yumæº: https://yum.puppetlabs.com/ â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸
               â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸ä¸åŒçš„ç³»ç»Ÿé€‰æ‹©ä¸åŒçš„æº. centos6/7 å°±æœ‰åŒºåˆ«.  â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸

                        ğŸ“Œåˆ«åœ¨Macä¸ŠæŠ˜è…¾ puppet-agent. æˆ‘åæ­£åŠå¤©æ²¡æŠ˜è…¾æˆåŠŸğŸ“Œ
    ğŸ”¸ç›®çš„: åœ¨æ— å…¬ç½‘IPçš„Centos7è™šæ‹Ÿæœºä¸Šæ­å»º puppet-server æœåŠ¡å™¨. æ§åˆ¶æœ‰å…¬ç½‘IPçš„ vps.(puppet-agent)ğŸ”¸






ğŸ”µ ä¸‰ä¸ªç»„ä»¶:
    ğŸ”¸puppet-server    Puppet Server. ä¼šè‡ªåŠ¨å®‰è£… puppet-agent!!!
    ğŸ”¸puppet-agent     å¤šåˆä¸€å®‰è£…åŒ….ä¼šå®‰è£… Puppet-agent, Ruby, Facter.ç­‰å„ç§ä¾èµ–.
                       ğŸ‘â€ğŸ—¨Facter è·å–å®¢æˆ·ç«¯æ•°æ®å¹¶ä¼ ç»™æœåŠ¡å™¨.
    ğŸ”¸puppetdb         æ•°æ®åº“. å¯ä»¥æ›´å¥½çš„ä½¿ç”¨ puppet.

        Puppet: C/Sæ¶æ„è½¯ä»¶.
            ğŸ“ŒæœåŠ¡å™¨ä¸€èˆ¬è¦å®‰è£… puppet-server
            ğŸ“Œå®¢æˆ·ç«¯ä¸€èˆ¬ä¹Ÿå®‰è£… puppet-server åæ­£ä¼šè‡ªåŠ¨å®‰è£…puppet-agentçš„.       


ğŸ”µ ç›®å½•
    ğŸ”¸è½¯ä»¶å®‰è£…ç›®å½•               /opt/puppetlabs
    ğŸ”¸æ‰§è¡Œæ–‡ä»¶ç›®å½•               /opt/puppetlabs/bin

    ğŸ”¸puppet-agent  é…ç½®æ–‡ä»¶   /etc/puppetlabs/puppet/puppet.conf    
    ğŸ”¸puppet-server é…ç½®æ–‡ä»¶   /etc/puppetlabs/puppetserver/puppetserver.conf

    ğŸ”¸agent  sslè¯ä¹¦å­˜æ”¾ç›®å½•         /etc/puppetlabs/puppet/ssl            
    ğŸ”¸server sslè¯ä¹¦å­˜æ”¾ç›®å½•         /etc/puppetlabs/puppetserver/ssl            



    ğŸ”¸æ‰€æœ‰çš„module/manifest/dataä»confdir ç§»åˆ°/etc/puppetlabs/code
        åŒ…å«environmentsç›®å½•
        åŒ…å«å…¨å±€çš„modulesç›®å½•





ğŸ”µ Puppet å·¥ä½œæµç¨‹

    puppetæ˜¯æ‰¹é‡ç®¡ç†æœåŠ¡å™¨çš„, æ¯”å¦‚è¦å®‰è£…/è¾“å‡º/æ›´æ–°è½¯ä»¶ã€æ–°å»º/åˆ é™¤ç”¨æˆ·ã€å¯åŠ¨/åœæ­¢è¿›ç¨‹...
    æ‰€æœ‰çš„é…ç½®æ–‡ä»¶éƒ½æ˜¯å‚¨å­˜åœ¨æœåŠ¡å™¨ä¸­.å®¢æˆ·ç«¯æ¯åŠå°æ—¶è¿ä¸€æ¬¡æœåŠ¡å™¨. çœ‹æœåŠ¡å™¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰æ›´æ–°.
    å¦‚æœæœ‰æ›´æ–°.å°±ä¸‹è½½é…ç½®æ–‡ä»¶.ç„¶ååœ¨æœ¬åœ°æ‰§è¡Œ

    å®¢æˆ·ç«¯çš„facter ä¼šè·å–å®¢æˆ·ç«¯è‡ªå·±ç”µè„‘çš„ä¿¡æ¯(å¦‚ä¸»æœºåï¼Œå†…å­˜å¤§å°ï¼Œipåœ°å€ç­‰) å‘é€ç»™æœåŠ¡å™¨.
    æœåŠ¡å™¨çš„facter æ ¹æ®å®¢æˆ·ç«¯ä¸»æœºå.åœ¨æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°å¯¹åº”çš„é…ç½®.æ¥åˆ†æå®¢æˆ·ç«¯æ˜¯å¦æˆåŠŸæ‰§è¡Œ

    å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ˜¯åŸºäºSSLè¯ä¹¦çš„.
    ä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥è¯·æ±‚è¿æ¥æœåŠ¡å™¨. ä½†æ˜¯åªæœ‰åœ¨æœåŠ¡å™¨åŒæ„åæ‰å¯ä»¥å’ŒæœåŠ¡å™¨é€šä¿¡!!

    puppet  ä¼šè®©ç³»ç»Ÿä¿æŒåœ¨äººä»¬æ‰€æœŸæœ›çš„æŸç§çŠ¶æ€å¹¶ä¸€ç›´ç»´æŒä¸‹å».ä¾‹å¦‚ï¼š
        ä¿è¯æŸä¸ªæ–‡ä»¶ä¸€ç›´å­˜åœ¨ï¼Œ å¦‚æœè¯¥æ–‡ä»¶è¢«åˆ é™¤äº†   puppetä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰ä¼šé‡æ–°åˆ›å»ºæ–‡ä»¶.
        ä¿è¯sshæœåŠ¡å§‹ç»ˆå¼€å¯ï¼Œ  å¦‚æœsshæœåŠ¡è¢«å…³é—­äº†  puppetä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰ä¼šé‡å¯sshæœåŠ¡.




ğŸ”µ å‚¨å¤‡çŸ¥è¯† rpm
    RPMè½¯ä»¶åŒ…çš„ç®¡ç†å·¥å…·.æœ€åˆæ˜¯ red hatç”¨æ¥ç®¡ç†linuxè½¯ä»¶ç¨‹åºçš„,ç”±äºéå¸¸å¥½ç”¨,è¢«centosç­‰ç³»ç»Ÿé‡‡ç”¨äº†.
    ğŸ”¸è¯­æ³•: rpm  âœš é€‰é¡¹  âœš è½¯ä»¶å.
    ğŸ”¸é€‰é¡¹:
        -i  æ˜¾ç¤ºå¥—ä»¶çš„ç›¸å…³ä¿¡æ¯ï¼› 
        -v  æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼› 
        -h  å¥—ä»¶å®‰è£…æ—¶åˆ—å‡ºæ ‡è®°ï¼› 
        -q  ä½¿ç”¨è¯¢é—®æ¨¡å¼ï¼Œå½“é‡åˆ°ä»»ä½•é—®é¢˜æ—¶ï¼ŒrpmæŒ‡ä»¤ä¼šå…ˆè¯¢é—®ç”¨æˆ·ï¼›
        -l  æ˜¾ç¤ºå¥—ä»¶çš„æ–‡ä»¶åˆ—è¡¨ï¼›

    ğŸ”¸å¸¸ç”¨é€‰é¡¹ç»„åˆ
        rpm -ivh       å®‰è£…è½¯ä»¶
        rpm -ql        æŸ¥çœ‹è½¯ä»¶å®‰è£…ä½ç½®.
        rpm --force -i â—ï¸â—ï¸â—ï¸â—ï¸å¼ºåˆ¶å®‰è£…â—ï¸â—ï¸â—ï¸â—ï¸
                æ­£å¸¸ä¸€èˆ¬æ·»åŠ å¯¹åº”æºä¹‹åå°±å¯ä»¥ç”¨ yum æ¥å®‰è£…å¯¹åº”çš„è½¯ä»¶äº†.
                ä½†æ˜¯å¦‚æœ rpm -ivh å®‰è£…è¿‡ç¨‹æŠ¥é”™. å°±å¯ä»¥ç”¨å¼ºåˆ¶å®‰è£…!!!
                rpm -ivh http://yum.puppetlabs.com/puppetlabs-release-el-6.noarch.rpm
                    ğŸ‘¹ package puppetlabs-release-22.0-2.noarch is already installed

                rpm --force -i http://yum.puppetlabs.com/puppetlabs-release-el-6.noarch.rpm
                è¿™ä¸‹å°±å¥½äº†!!!  





      
ğŸ”µ å¸¸ç”¨å‘½ä»¤

    ğŸ”…puppet help æŸ¥çœ‹å„ç§å‘½ä»¤.

    ğŸ”…puppet help agent                æŸ¥çœ‹agentè¯¥å­å‘½ä»¤çš„è¯¦ç»†ç”¨æ³•.
        puppet agent -V/--version    æŸ¥çœ‹ç‰ˆæœ¬
        puppet agent --verbose/-v    è¯¦ç»†è¾“å‡ºå‘½ä»¤.  
        puppet agent --test / -t     æµ‹è¯•è¿æ¥.
        puppet agent --noop          æ¨¡æ‹Ÿè¿è¡Œ.

    ğŸ”¸è¯ä¹¦ç›¸å…³å‘½ä»¤:.
        puppet cert list                     åˆ—å‡ºæœªç­¾åè¯·æ±‚. (æœªç­¾åæœ€å‰é¢æ²¡æœ‰+å·)
        puppet cert list --all               åˆ—å‡ºæ‰€æœ‰çš„ç­¾å. åŒ…æ‹¬å·²ç­¾åçš„(å·²ç­¾åæœ€å‰é¢æœ‰ä¸ª+å·)
        puppet cert sign host2.example.com   ç»™æŸä¸ªå®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œç­¾å(æœåŠ¡å™¨ä¸Šæ“ä½œ).
        puppet cert sign --all               ç»™æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œç­¾å(æœåŠ¡å™¨ä¸Šæ“ä½œ).


        ss -tlunp | grep puppet           æŸ¥çœ‹puppetçš„ç«¯å£ é»˜è®¤8140
        ğŸ‘â€ğŸ—¨ å‡çº§ç‰ˆæœ¬. å…ˆå¸è½½(yum remove puppet-server) å†å®‰è£…







â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¤ï¸è½¯ä»¶å®‰è£…â¤ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
â¤ï¸CentOS6 å®‰è£… (è¯¦ç»†)

    ğŸ”µä¾èµ–ç¯å¢ƒ
        ğŸ”¸ lsb_release -a                æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬. âœ  Description:	CentOS release 6.9 (Final)
        ğŸ”¸ uname -a                      æŸ¥çœ‹ç³»ç»Ÿæ˜¯32ä½è¿˜æ˜¯64ä½. åªæœ‰è¾“å‡ºæ˜¯x86_64 æ‰æ˜¯64ä½çš„. å…¶ä»–éƒ½æ˜¯32ä½çš„!!!!
        ğŸ”¸ yum install ruby ruby-rdoc    å®‰è£…rubyç¯å¢ƒ.
        ğŸ”¸ æ·»åŠ puppet çš„å®˜æ–¹yumæº.
            rpm -ivh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-6.noarch.rpm
            â—ï¸â—ï¸è¿™ä¸ªPC1æº(Puppet Collections)æ‰å¯ä»¥å®‰è£…4.+ç‰ˆæœ¬ â—ï¸â—ï¸

                    rpm -ivh http://yum.puppetlabs.com/puppetlabs-release-el-6.noarch.rpm
                    ğŸ‘â€ğŸ—¨ è¿™ä¸ªæºæœ€é«˜åªèƒ½å®‰è£… 3.8.7çš„ç‰ˆæœ¬!! åˆ«ç”¨è¿™ä¸ªæº.

                    ğŸ‘¹ package puppetlabs-release-22.0-2.noarch is already installed
                    å¦‚æœå‡ºç° xxx is already installed ç±»ä¼¼æç¤º.  ç”¨ rpm --force -i  âœš ç½‘å€ å¼ºåˆ¶å®‰è£….
                    rpm --force -i https://yum.puppetlabs.com/puppetlabs-release-pc1-el-6.noarch.rpm

    ğŸ”µå®‰è£…puppet-server
        ğŸ”¸yum install puppetserver
            ğŸ‘â€ğŸ—¨ 4+ ç‰ˆæœ¬å’Œ3+çš„å®‰è£…å‘½ä»¤æ˜¯ä¸ä¸€æ ·çš„ 3+ çš„å¥½åƒæ˜¯: yum install puppetmaster
            Serveré»˜è®¤å¯¹å†…å­˜è¦æ±‚é«˜å¾—2G... 256mçš„vpsè·‘ä¸ªå®¢æˆ·ç«¯å°±å¯ä»¥äº†åˆ«è·‘æœåŠ¡ç«¯äº†...
        ğŸ”¸ é…ç½®ç¯å¢ƒè·¯å¾„
                å®‰è£…å¥½åä½ ä¼šå‘ç°ä¸èƒ½æ‰§è¡Œpuppetå‘½ä»¤!
                    ğŸ‘â€ğŸ—¨ å¦‚æœä½ ç”¨çš„æ˜¯ 3.8.7 çš„é‚£ä¸ªæºæ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨puppetå‘½ä»¤çš„.ä¹Ÿå°±ä¸éœ€è¦é…ç½®ç¯å¢ƒè·¯å¾„. 
                æ­£å¸¸ puppet agent -V å°±èƒ½æ˜¾ç¤ºå½“å‰å®¢æˆ·ç«¯ç‰ˆæœ¬çš„.
                ğŸ“ŒPuppet4 çš„å˜åŒ–æ¯”è¾ƒå¤§. 
                    ğŸ‘â€ğŸ—¨ é…ç½®è·¯å¾„: /etc/pupperlabs
                    ğŸ‘â€ğŸ—¨ ç¨‹åºè·¯å¾„: /opt/puppetlabs
                ç›´æ¥å»ç¨‹åºå®‰è£…è·¯å¾„å»çœ‹çœ‹èƒ½ä¸èƒ½æ‰§è¡Œ.
                cd /opt/puppetlabs/bin
                ./puppet agent -V
                    è¿™ä¸‹å°±æ˜¾ç¤ºå‡ºå½“å‰ç‰ˆæœ¬äº†!è¯´æ˜å®‰è£…æˆåŠŸçš„.è‡ªå·±é…ä¸‹ç¯å¢ƒè·¯å¾„å°±å¥½äº†. 
                    è¿™ä¸€è¿™ä¸ªå‘½ä»¤å‰çš„ ./ è¿™ä¸ªè¡¨ç¤ºå½“å‰æ–‡ä»¶å¤¹!!!!

                ä¸‹é¢æˆ‘ä»¬æ‰‹åŠ¨æŠŠ /opt/puppetlabs/bin   è¿™ä¸ªè·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒè·¯å¾„ä¸­!!
                ä»¥åä»»ä½•ä½ç½®éƒ½å¯ä»¥è¿è¡Œpuppetå‘½ä»¤äº†. è€Œä¸æ˜¯å¿…é¡»cdåˆ°puppetçš„å®‰è£…è·¯å¾„ä¸‹æ‰èƒ½è¿è¡Œpuppetå‘½ä»¤.
                ç¯å¢ƒè·¯å¾„ å’Œä½ ä½¿ç”¨çš„sehllæœ‰å…³. 
                æˆ‘ç”¨zsh é‚£ä¹ˆåªè¦åœ¨  ~/.zshrc è¿™ä¸ªæ–‡ä»¶é‡ŒåŠ ä¸‹é¢è¡Œ.ç„¶åé‡å¯shellç”Ÿæ•ˆ.
                export PATH=/opt/puppetlabs/bin:$PATH
                åœ¨æ–‡ä»¶å°¾éƒ¨æ·»åŠ ä¸€è¡Œ æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨echo. å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨viæ·»åŠ .
                ğŸ”… echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.zshrc
                ğŸ‘â€ğŸ—¨ è¿™é‡Œå¿…é¡»ç”¨ å•å¼•å·. å•å¼•å·é‡Œé¢çš„å†…å®¹æ‰ä¼šä¸€æ¨¡ä¸€æ ·çš„è¿½åŠ åˆ°æ–‡ä»¶ä¸­.ä¸ç„¶$PATHè¿™ä¸ªå˜é‡ä¼šå±•å¼€.
                ğŸ‘â€ğŸ—¨ æ·»åŠ å˜é‡åè®°å¾—é‡å¯shell. æœåŠ¡å™¨çš„è¯.æ–­å¼€ssh é‡æ–°è¿å°±å¯ä»¥äº†.

                
â¤ï¸ CentOS 7x64 å®‰è£…é…ç½® (ç®€å•)

    ğŸ”¸ yum install ruby ruby-rdoc             âœ å®‰è£…rubyç¯å¢ƒ.
    ğŸ”¸ rpm -ivh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-6.noarch.rpm   æ·»åŠ puppet çš„å®˜æ–¹yumæº.
    ğŸ”¸ yum install puppetserver               âœ å®‰è£…puppet-server 
    ğŸ”¸  vi /etc/sysconfig/puppetserver        âœ ä¿®æ”¹å†…å­˜è¦æ±‚.   
        JAVA_ARGS="-Xms2g -Xmx2g"             âœ è¿™è¡Œçš„2gæ”¹æ‰å¦‚:
        JAVA_ARGS="-Xms256m -Xmx256m"
    ğŸ”¸ ç¯å¢ƒè·¯å¾„(æŒ‰bashé€‰ä¸€ä¸ªå°±å¯ä»¥)
        echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.bash_profile
        echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.zshrc
    ğŸ”¸ é‡å¯shell
    ğŸ”¸ puppetserver start                     âœ å¯åŠ¨puppet-server 
    ğŸ”¸ service puppetserver status            âœ æŸ¥çœ‹puppetserver è¿è¡ŒçŠ¶æ€.  
    ğŸ”¸ namp 127.0.0.1                         âœ æŸ¥çœ‹ç«¯å£æ˜¯å¦æ­£å¸¸å¼€å¯
                                              âœ nmap é»˜è®¤åªæ‰«æ 1000ä¹‹å†…çš„ç«¯å£å•Š.
                                              âœ è®°å¾—åŠ å‚æ•°!!!    nmap -p 8140 127.0.0.1  
                                              âœ æˆ–è€…ç”¨ netstat -nlatp | grep 8140



â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¤ï¸ FRP å†…ç½‘ç©¿é€è®¾ç½®â¤ï¸ ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
    è§’è‰²           ç³»ç»Ÿ             IPåœ°å€    å®‰è£…è½¯ä»¶           ä¸»æœºå.
    puppet-server  Centos7(è™šæ‹Ÿæœº)  å†…ç½‘IP    puppet-server      VM-C7     
    puppet-agent   Centos6(VPS)     å…¬ç½‘IP    puppwt-agent       mail.0214.help 

è¦ä½¿ç”¨ puppet. å¿…é¡»ä¿è¯ åŒæ–¹èƒ½ç”¨åŸŸåäº’ç›¸è§£æåˆ°. 
å› ä¸º puppet æ˜¯é€šè¿‡  VM-C7 å’Œ mail.0214.help  ä¸»æœºåæ¥äº’ç›¸äº¤æµçš„!

ğŸ”µ å¦‚æœ puppet-server å’Œ puppet-agent éƒ½åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…. æ¯”å¦‚:
    puppet-server çš„IPåœ°å€æ˜¯ 192.168.1.1, ä¸»æœºåæ˜¯ master
    puppet-agent  çš„IPåœ°å€æ˜¯ 192.168.1.2, ä¸»æœºåæ˜¯ client

    é‚£ä¹ˆåŸŸåè§£æéå¸¸ç®€å•.
        åªè¦åœ¨puppet-server çš„hostsæ–‡ä»¶æ·»åŠ ä¸€è¡Œ: 192.168.1.2  client
            æ·»åŠ åä½ å»puppet-server ç”µè„‘å¼€ç»ˆç«¯ ping client å°±æ˜¯ping 192.168.1.2

        åªè¦åœ¨puppet-agent çš„hostsæ–‡ä»¶æ·»åŠ ä¸€è¡Œ: 192.168.1.1  master
            æ·»åŠ åä½ å»puppet-agent ç”µè„‘å¼€ç»ˆç«¯ ping master å°±æ˜¯ping 192.168.1.1

        è¿™å°±æ˜¯åŸŸåè§£æ. ä¹Ÿå°±æ˜¯æŠŠä¸€ä¸ªåå­— å¯¹åº”åˆ°ä¸€ä¸ªIPä¸Š. å°±è¿™ä¹ˆç®€å•.

ğŸ”µ å¦‚æœ puppet-server å’Œ puppet-agent ä¸åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†….æ¯”å¦‚:
    puppet-server çš„å†…ç½‘IPåœ°å€æ˜¯ 192.168.1.1,  ä¸»æœºåæ˜¯ VM-C7
    puppet-agent  çš„å…¬ç½‘IPåœ°å€æ˜¯ 23.105.192.96 ä¸»æœºåæ˜¯ mail.0214.help
    è¦å®ç°äº’ç›¸è§£æå°±éœ€è¦å¯¹ç½‘ç»œ å’Œ puppet æœ‰ç‚¹äº†è§£äº†. éœ€è¦å€ŸåŠ©å†…ç½‘ç©¿é€å·¥å…·.æ¨èç”¨frp. 
    ä¸¤å°puppetè¡¨é¢ä¸Šæ˜¯é€šè¿‡ åŸŸåæ¥äº’ç›¸äº¤æµçš„. å®é™…ä¸Šæ˜¯é€šè¿‡IPæ¥äº’ç›¸äº¤æµçš„.
    ç”¨åŸŸååªæ˜¯ä¸ºäº†æ–¹ä¾¿äººç±»è®°å¿†. å¥½æ¯” å§“åå’Œèº«ä»½è¯å·ç . è‚¯å®šæ˜¯å§“åå®¹æ˜“è®°å•Š..

    å†æ·±å…¥ä¸€ç‚¹. æœåŠ¡å™¨å¯ä»¥åŒæ—¶è¿è¡Œå¾ˆå¤šè½¯ä»¶.ä¸€èˆ¬ä¸€ä¸ªæœåŠ¡å™¨ä¹Ÿå°±ä¸€ä¸ªå¤–ç½‘IP.
    ç”µè„‘ä¸Šçš„æ¯ä¸ªè½¯ä»¶åªç”¨äº†IPçš„å‡ ä¸ªç«¯å£è€Œå·².
    æ¯”å¦‚ç½‘é¡µ:   http çš„80ç«¯å£ã€https çš„443ç«¯å£.
    æ¯”å¦‚puppet: puppet-server çš„8140ç«¯å£. puppet-agent çš„8139ç«¯å£.

    å…¶å® puppet-server å’Œ puppet-agent ä¹‹é—´ç”¨çš„æ˜¯ http åè®®.
    puppet-agent é€šè¿‡ç”µè„‘ä¸Šçš„8139ç«¯å£ å‘æ¶ˆæ¯ç»™ puppet-server ä¸Šçš„8140ç«¯å£.
    æ—¢ç„¶ç«¯å£æ˜¯ç¡®å®šçš„. æˆ‘ä»¬ä¸ç”¨ç®¡.é‚£ä¹ˆæˆ‘ä»¬åªè¦è§£å†³IPé—®é¢˜å°±å¥½äº†. 
    puppet-agent æœåŠ¡å™¨æ˜¯æœ¬èº«å¸¦æœ‰å…¬ç½‘IPçš„. ä»»ä½•ç”µè„‘è¦è§£æåˆ°puppet-agentå¾ˆç®€å•.  è§£æå¯ä»¥ç†è§£æˆè¿æ¥. æ¯”å¦‚sshè¿æ¥.
    puppet-server æ˜¯å†…ç½‘ç”µè„‘.æ²¡æœ‰IPçš„.     ä»»ä½•ç”µè„‘è¦è§£æåˆ°puppet-serverå°±å¾ˆéš¾. ç”¨äº† frpå°±å¾ˆç®€å•!!!
    frp åŸç†è¿™é‡Œä¸è¯´. è‡ªå·±çœ‹ frp.txtå».


ğŸ”µ FRPæœåŠ¡å™¨è®¾ç½® (Centos6 VPS å…¬ç½‘IP: 23.105.192.96)
    vi frps.ini                 âœ ç¼–è¾‘frpæœåŠ¡å™¨é…ç½®æ–‡ä»¶,æ·»åŠ ä¸‹é¢ä¸‰è¡Œ: 
    [vm-centos7-puppetserver]   âœ æ¨¡å—åå­—. åå­—ä»»æ„å–.ä½†æ˜¯å¿…é¡»å’Œfrpå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸­çš„æ¨¡å—åä¸€æ ·.
    auth_token = 123            âœ å¯†ç . æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ äº¤æµè¦å…ˆå¯¹æ¯”å¯†ç çš„. åŒæ–¹å¯†ç ä¸€ç›´æ‰å¯ä»¥æˆåŠŸè¿ä¸ŠæœåŠ¡å™¨.
    listen_port = 8140          âœ è¿™ä¸ªå°±æ˜¯é‡ç‚¹äº†. è¿™ä¸ªæ˜¯frpæœåŠ¡å™¨ç«¯å£.
                                âœ å¦‚æœæœ‰äººè®¿é—®23.105.192.96:8140 é¦–å…ˆæ˜¯è¿æ¥åˆ°frpæœåŠ¡å™¨è¿™å°ç”µè„‘.
                                âœ ç„¶åfrpæœåŠ¡å™¨å°±ä¼šæŠŠè¿™ä¸ªç«¯å£çš„æ‰€æœ‰æ•°æ®è½¬å‘ç»™æˆ‘ä»¬ç­‰ä¸‹å°±å»è®¾ç½®çš„å®¢æˆ·ç«¯.
                                âœ æ–‡ä»¶ç¼–è¾‘å¥½åéœ€è¦é‡å¯frpæœåŠ¡.

    ğŸ”¸ pidof frps                    âœ æ‰¾å‡ºfrpsè¿›ç¨‹: 
    ğŸ”¸ kill xxx                      âœ æ€æ­»frpsè¿›ç¨‹. ä¹Ÿå°±æ˜¯åœæ­¢ç¨‹åºäº†.
    ğŸ”¸ ./frps -c ./frps.ini          âœ æµ‹è¯•å¯åŠ¨. æœ‰é”™è¯¯ä¼šæŠ¥é”™! æ²¡æŠ¥é”™å†ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œåå°é•¿æœŸè¿è¡Œ..
    ğŸ”¸ nohup ./frps -c ./frps.ini &  âœ åå°è¿è¡Œ.æ–­å¼€sshä¹Ÿæ²¡å…³ç³».



ğŸ”µ FRPå®¢æˆ·ç«¯è®¾ç½® (puppet-server Centos7 è™šæ‹Ÿæœº)
    ğŸ”¸ä¸‹è½½å¯¹åº”çš„å®¢æˆ·ç«¯ wget https://github.com/fatedier/frp/releases/download/v0.9.3/frp_0.9.3_linux_386.tar.gz
    ğŸ”¸ è§£å‹æ–‡ä»¶        tar -xzf 
    ğŸ”¸ vi frpc.ini  ç¼–è¾‘frpå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶
    [common]                       âœ åˆ«åŠ¨; è¿æ¥FRPæœåŠ¡å™¨çš„æ¨¡å—åç§°.
    server_addr = 23.105.192.96    âœ ä¿®æ”¹; FRPæœåŠ¡å™¨IP    
    server_port = 7000             âœ ä¸ç®¡; FRPæœåŠ¡å™¨ç«¯å£. 

    auth_token = 123               âœ ä¸ç®¡
    privilege_token = 12345678     âœ ä¸ç®¡

    [vm-centos7-puppetserver]      âœ é‡ç‚¹! è¿™ä¸ªéœ€è¦å’ŒFRPæœåŠ¡å™¨ä¸Šçš„æ¨¡å—åå¯¹åº”.
    local_port = 8140              âœ é‡ç‚¹! ä»»ä½•æ•°æ®è®¿é—®æœåŠ¡å™¨ä¸Šçš„ 8140ç«¯å£ 23.105.192.96:8140 
                                        FRPæœåŠ¡å™¨ å°±ä¼šæŠŠæ•°æ®è½¬å‘åˆ°è¿™å°ç”µè„‘. ä½†æ˜¯è¿™å°ç”µè„‘æœ‰å¾ˆå¤šç«¯å£. 
                                        local_port=8140çš„æ„æ€å°±æ˜¯ è½¬å‘åˆ°8140è¿™ä¸ªç«¯å£
                                        ç°åœ¨åˆ«çš„iFFmpegæŒ‰é’®è¡¨é¢ä¸Šæ˜¯è®¿é—®çš„ 23.105.192.96:8140 
                                        å…¶å®ç»è¿‡frpæœåŠ¡å™¨åœ¨ä¸­è½¬å å®é™…å°±å˜æˆäº†è®¿é—® puppet-serverçš„8140ç«¯å£äº†.
                                        ä¹Ÿå°±æ˜¯åˆ«çš„ç”µè„‘æƒ³è¦è¿æ¥åˆ° pupper-server.
    ğŸ”¸nohup ./frpc -c ./frpc.ini &  âœ åå°å¯åŠ¨frp å®¢æˆ·ç«¯





â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸ åŸŸåè§£æ â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸

ğŸ”¸ å…³é—­ SELINUX
    Security-Enhanced Linuxçš„ç¼©å†™ï¼Œæ˜¯ä¸€ç§éå¸¸å®‰å…¨çš„LINUXæ¨¡å¼ã€‚
    åŸºæœ¬ä¸Šç”¨æˆ·å¾—ä¸åˆ°ä»€ä¹ˆæƒé™åœ¨è¿™ä¸ªç³»ç»Ÿä¸‹é¢ã€‚
    ğŸ”…  /usr/sbin/sestatus -v                     âœ æŸ¥çœ‹å½“å‰SELINUXçŠ¶æ€. 
        vi /etc/selinux/config                    âœ ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶æ¥æ°¸ä¹…å…³é—­SELINUX
        å°†SELINUX=enforcingæ”¹ä¸ºSELINUX=disabled   âœ ä¿®æ”¹åé‡å¯ç”µè„‘.


ğŸ”¸ æ–°æ‰‹å…³é—­é˜²ç«å¢™.

ğŸ”¸ æ—¶é—´è®¾ç½®
       Puppetçš„masterèŠ‚ç‚¹çš„æ—¶é—´å¿…é¡»è®¾ç½®å‡†ç¡®ï¼Œå› ä¸ºä»–å°†ç”¨äºè¯ä¹¦ç­¾å‘.å°½å¯èƒ½çš„ä½¿ç”¨NTP.

ğŸ”¸Cent0s7 æ›´æ”¹ä¸»æœºå:
        hostname                                      âœ æŸ¥çœ‹å½“å‰ä¸»æœºå.
        sudo hostnamectl --static set-hostname VM-C7  âœ æ°¸ä¹…æ›´æ”¹ä¸»æœºåæˆVM-C7


ğŸ”¸puppet-agentåŸŸåè§£æ
    vi /etc/hosts         
    23.105.192.96 VM-C7 âœ  æ·»åŠ è¿™è¡Œå°±å¯ä»¥äº†. ä½ ä¸ç”¨ç®¡ç«¯å£çš„ 
                        âœ è¿™ä¸ªç”µè„‘è¿è¡Œçš„æ˜¯puppet-agent é‚£ä¹ˆå®ƒè‚¯å®šæ˜¯å»è¿æ¥æœåŠ¡å™¨çš„.è‚¯å®šæ˜¯å»è¿æ¥8140ç«¯å£çš„.
                        âœ 23.105.192.96:8140 ç«¯å£çš„æ‰€æœ‰æ•°æ®.éƒ½ä¼šè¢«frpæœåŠ¡å™¨.è½¬ä¸ªpuppet-serverçš„8140ç«¯å£.

ğŸ”¸ ç¼–è¾‘puppet-agenté…ç½®æ–‡ä»¶. åœ¨[agent]æ¨¡å—ä¸‹æ·»åŠ ä¸‹é¢ä¸€è¡Œ.
    vi /etc/puppetlabs/puppet/puppet.confi
    server = VM-C7      âœ è¿™ä¸ªå°±æ˜¯ä½ è¦è¿æ¥çš„ puppet-server çš„ä¸»æœºå/åŸŸå
                        âœ puppet-agent æ˜¯è¿åˆ°å«è¿™ä¸ªåå­—çš„æœåŠ¡å™¨ä¸Šçš„. 
                        âœ è¿™ä¸ªåå­—å¯¹åº”çš„ip å°±æ˜¯æˆ‘ä»¬hostsæ–‡ä»¶é‡Œæ·»åŠ çš„dnsè§£æ

ğŸ”¸ puppet-agent è¿æ¥æœåŠ¡å™¨æµ‹è¯•
    ğŸ”… puppet agent --test
    Info: Creating a new SSL key for mail.0214.help

    puppet ä¸ºäº†ä¿¡æ¯å®‰å…¨. åŒæ–¹é‡‡ç”¨äº†SSLåè®®. ä¹Ÿå°±æ˜¯https. éœ€è¦ç”¨åˆ°è¯ä¹¦!
    å®¢æˆ·ç«¯è¿è¡Œ å°±è‡ªåŠ¨ä¼šå‘æœåŠ¡å™¨ç”³è¯·å»ºç«‹è¿æ¥. 
    è¿™æ—¶å€™è¦å»æœåŠ¡å™¨åŒæ„å®¢æˆ·ç«¯çš„è¿æ¥.å®¢æˆ·ç«¯æ‰èƒ½çœŸæ­£è¿ä¸ŠæœåŠ¡å™¨.
    åŒæ„è¿æ¥è¿™ä¸ªæ“ä½œå°±å«ç­¾å.
    æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å°±ä¼šé•¿æœŸä¿æŒé€šä¿¡(å®¢æˆ·ç«¯æ¯åŠå°æ—¶è¿ä¸€æ¬¡æœåŠ¡å™¨)!!!


ğŸ”¸ puppet-server æœåŠ¡å™¨æŸ¥çœ‹å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚
    ğŸ”…puppet cert list
      "mail.0214.help" (SHA256) 6E:3F:48:F6:F1:52:18:30:F8:DD:2F:D3:7E:BA:C1:2E:1E:89:8A:0D:37:96:DF:E3:F5:79:A0:7F:85:5C:28:97
      å‡ºç°ä¸€ä¸ª å‰é¢æ²¡å¸¦åŠ å·çš„ å°±è¯´æ˜æœ‰å®¢æˆ·ç«¯æƒ³è¦è¿æœåŠ¡å™¨.å¦‚æœä½ åŒæ„å¯¹æ–¹è¿æ¥ å°±éœ€è¦ç­¾å.

ğŸ”¸ puppet-server å¯¹å®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œç­¾å
    ğŸ”…puppet cert sign mail.0214.help
    Signing Certificate Request for:
    "mail.0214.help" (SHA256) 6E:3F:48:F6:F1:52:18:30:F8:DD:2F:D3:7E:BA:C1:2E:1E:89:8A:0D:37:96:DF:E3:F5:79:A0:7F:85:5C:28:97
    Notice: Signed certificate request for mail.0214.help
    Notice: Removing file Puppet::SSL::CertificateRequest mail.0214.help at '/etc/puppetlabs/puppet/ssl/ca/requests/mail.0214.help.pem'


ğŸ”¸puppet-server æŸ¥çœ‹æ‰€æœ‰è¯ä¹¦
    ğŸ”…requests puppet cert list -all
    + "mail.0214.help" (SHA256) 4D:01:04:D7:4B:C8:75:D6:C2:D5:63:BA:93:46:C2:E1:D9:82:D6:97:AA:AC:A8:50:69:9F:6A:A8:67:27:67:F2
    + "mail.0214.live" (SHA256) D3:D7:DB:74:E6:53:CC:0F:EE:55:83:5E:65:A5:9B:32:4B:D6:9F:E5:DA:D1:50:67:88:31:3C:44:EE:C0:EE:92

ğŸ”¸puppet-server å¤±æ•ˆæŸè¯ä¹¦  puppet cert --revoke mail.0214.live
ğŸ”¸puppet-server åˆ é™¤æŸè¯ä¹¦  puppet cert --clean mail.0214.live
è¯ä¹¦ç­¾åçš„è¿‡æœŸæˆ–åˆ é™¤éœ€è¦é‡å¯puppetmasteræœåŠ¡ã€‚


ğŸ”¸puppet-agent è¿æ¥è®¾ç½®.
    âœ  puppet puppet agent --test
    Error: Could not request certificate: The certificate retrieved from the master does not match the agent's private key.
    Certificate fingerprint: 4D:01:04:D7:4B:C8:75:D6:C2:D5:63:BA:93:46:C2:E1:D9:82:D6:97:AA:AC:A8:50:69:9F:6A:A8:67:27:67:F2
    To fix this, remove the certificate from both the master and the agent and then start a puppet run, which will automatically regenerate a certificate.
    On the master:
    puppet cert clean mail.0214.help
    On the agent:
    1a. On most platforms: find /etc/puppetlabs/puppet/ssl -name mail.0214.help.pem -delete
    1b. On Windows: del "\etc\puppetlabs\puppet\ssl\certs\mail.0214.help.pem" /f
    2. puppet agent -t


    ğŸ“Œå¦‚æœå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨å‡ºé—®é¢˜. 
    ğŸ“Œ 1. é¦–å…ˆæ’é™¤frpé—®é¢˜. çœ‹frps/frpc æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
    ğŸ“Œ 2. è¿›è¡Œä¸‹é¢çš„æ­¥éª¤
    ğŸ“Œè¿˜ä¸è¡Œå°±é‡è£…å®¢æˆ·ç«¯.   è¿˜ä¸è¡Œå°±é‡è£…æœåŠ¡å™¨.  å†ä¸è¡Œå°±è‡ªå·±åˆ†æé—®é¢˜åŸå› äº†.
    1. å®¢æˆ·ç«¯: rm -r /etc/puppetlabs/puppet/ssl        åˆ é™¤æ•´ä¸ªsslæ–‡ä»¶å¤¹. ä¸è¦åªåˆ é™¤æŸä¸ªæ–‡ä»¶.
    2. å®¢æˆ·ç«¯: mkdir /etc/puppetlabs/puppet/ssl        æ–°å»º ssl æ–‡ä»¶å¤¹
    3. æœåŠ¡å™¨: puppet cert clean mail.0214.help        åˆ é™¤è¯ä¹¦. 
    4. æœåŠ¡å™¨ï¸:ï¸ puppetserver reload ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸       åˆ é™¤/å¤±æ•ˆæŸè¯ä¹¦åå¿…é¡»é‡å¯æœåŠ¡å™¨
    5. å®¢æˆ·ç«¯: puppet agent --test                     é‡æ–°ç”³è¯·è¯ä¹¦.
    6. æœåŠ¡å™¨: puppet cert list                        åˆ—å‡ºå®¢æˆ·ç«¯çš„è¯·æ±‚
    7. æœåŠ¡å™¨: puppet cert sign mail.0214.help         å¯¹mail.0214.help è¿™å®¢æˆ·ç«¯è¿›è¡Œç­¾å.
    8. å®¢æˆ·ç«¯: puppet agent --test                     é‡æ–°è¯·æ±‚è¿æ¥.
        ğŸ‘¹ Info: Caching certificate for mail.0214.help
        Error: Could not request certificate: 
        Server hostname 'VM-C7' did not match server certificate; 
        expected one of localhost.localdomain, DNS:puppet, DNS:localhost.localdomain
        Exiting; failed to retrieve certificate and waitforcert is disabled
            åˆæŠ¥é”™äº†...  æœåŠ¡å™¨çš„åå­— å’ŒæœåŠ¡å™¨çš„è¯ä¹¦ä¸æœ.
            é—®é¢˜å‡ºåœ¨æœåŠ¡å™¨. å…¶å®æœåŠ¡å™¨æ˜¯æ”¹è¿‡ä¸»æœºåå­—çš„. 
            åŸæ¥åå­—æ˜¯ localhost.localdomain å®‰è£…å¥½puppetserveråæ”¹æˆVM-C7äº†.
            å…¶å®puppetserver å®‰è£…çš„æ—¶å€™æ˜¯éœ€è¦ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦çš„! ç”Ÿæˆè¯ä¹¦è‚¯å®šç”¨åˆ°ä¸»æœºåçš„. 
            è¿™æ—¶å€™ç”¨çš„ä¸»æœºåæ˜¯localhost.localdomain.  å¯¹åº”æœåŠ¡å™¨è¯ä¹¦ä¸Šçš„ä¸»æœºåæ˜¯localhost.localdomain
            ğŸ”¸è§£å†³æ–¹æ³•ä¸€: å¸è½½é‡è£….puppet-server

            ğŸ”¸è§£å†³æ–¹æ³•äºŒ: å®¢æˆ·ç«¯: æ·»åŠ å‚æ•°. --server 
                âœ  ~ puppet agent --test --server localhost.localdomain
                Info: Caching certificate_revocation_list for ca
                Info: Using configured environment 'production'
                Info: Retrieving pluginfacts
                Info: Retrieving plugin
                Info: Caching catalog for mail.0214.help
                Info: Applying configuration version '1492656142'
                Info: Creating state file /opt/puppetlabs/puppet/cache/state/state.yaml

            ğŸ”¸è§£å†³æ–¹æ³•ä¸‰: 
                ç¼–è¾‘å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ [anent] ä¸‹é¢çš„server name æ”¹æ‰
                vi /etc/puppetlabs/puppet/puppet.conf
                server = localhost.localdomain

                è¿˜è¦æ·»åŠ  ä¸€æ¡åŸŸåè§£æ..
                vi /etc/hosts
                23.105.192.96 localhost.localdomain

                âœ  puppet puppet agent -t
                Info: Using configured environment 'production'
                Info: Retrieving pluginfacts
                Info: Retrieving plugin
                Info: Caching catalog for mail.0214.help
                Info: Applying configuration version '1492656538'
                Notice: Applied catalog in 0.02 seconds




â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸---ä½¿ç”¨---â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
æ¨èæ–‡ç« :  https://pom.nops.cloud/bestpractice/puppet4.html

ç»è¿‡åƒè¾›ä¸‡è‹¦å®¢æˆ·ç«¯ç»ˆäºæˆåŠŸè¿ä¸ŠæœåŠ¡å™¨äº†.ç¯å¢ƒç®—æ­å¥½äº†.æˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆç”¨.














ç›®çš„: è®©å®¢æˆ·ç«¯è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª  aa ç”¨æˆ·.

æœåŠ¡å™¨åªæœ‰ä¸€å°. å®¢æˆ·ç«¯å¯ä»¥æœ‰åƒä¸‡å°. 
æ¯å°å®¢æˆ·ç«¯ä½ éƒ½å¯ä»¥æœ‰è‡ªå·±çš„é…ç½®(æ¨¡å—).
å®¢æˆ·ç«¯è¿ä¸ŠæœåŠ¡å™¨. é¦–å…ˆè¦æŸ¥æ‰¾è‡ªå·±çš„æ¨¡å—!!!


ğŸ“Œ Puppet ä¸¤ç§æ‰§è¡Œæ¨¡å¼:
    ç›´æ¥è¯»å–puppet file.manifesté…ç½®
    é€šè¿‡puppetd --server puppetmaster.server.comï¼Œä»æœåŠ¡ç«¯ä¸‹è½½manifesté…ç½®

å¦‚æœæ˜¯æœ





ğŸ”µ site.pp
site.ppæ–‡ä»¶æ˜¯puppetè¯»å–æ‰€æœ‰æ¨¡å—ppæ–‡ä»¶çš„å¼€å§‹
è¿™ä¸ªæ–‡ä»¶çš„è·¯å¾„å‘¢...
/etc/puppetlabs/code  ????


å†æœªæŒ‡å®šmodulepathæœç´¢è·¯å¾„çš„æƒ…å†µä¸‹ï¼Œä¼šæœ‰é»˜è®¤æœç´¢è·¯å¾„çš„ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹åˆ°















motd æ¨¡å—é»˜è®¤è·¯å¾„.
/etc/puppetlabs/code/modules:/opt/puppetlabs/puppet/modules


åˆ›å»ºæ¨¡å—ç›®å½•ç»“æ„:
/etc/puppetlabs/code/modules/
â””â”€â”€ motd
    â”œâ”€â”€ files  #å­˜æ”¾æ–‡ä»¶ç›®å½•
    â”‚   â””â”€â”€ etc
    â”‚       â””â”€â”€ motd
    â”œâ”€â”€ manifests  #å­˜æ”¾æ¨¡å—ppé…ç½®æ–‡ä»¶ç›®å½•
    â”‚   â””â”€â”€ init.pp
    â””â”€â”€ templates #å­˜æ”¾æ¨¡æ¿ç›®å½•


æ¨¡å—æ–‡ä»¶å¤¹å¯ä»¥å­˜æ”¾ æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ã€ æœ‰äº›å‘½ä»¤çš„è¿è¡Œ éœ€è¦ç”¨åˆ°æŸäº›æ–‡ä»¶çš„.

manifests æ–‡ä»¶å¤¹:
init.pp
user{'11':
    name => xu,
    ensure => present,
}


site.pp
$puppetserver = 'localhost.localdomain' #è®¾ç½®å…¨å±€å˜é‡
node 'mail.0214.help'{
  include  motd
}



å»æµ‹è¯•....









ğŸ”µ ç¼–å†™ ppæ–‡ä»¶
é…ç½®åç¼€åæ˜¯.pp
ğŸ”¸é…ç½®æ–‡ä»¶è·¯å¾„æ˜¯:  
puppet3 çš„é…ç½®æ–‡ä»¶è·¯å¾„æ˜¯: /etc/puppet/modules/motd/manifests/xxx.pp
puppet4 çš„é…ç½®æ–‡ä»¶è·¯å¾„æ˜¯: /etc/puppetlabs/code/modules/motd/manifests/test.pp

åœ¨è¿™é‡Œåˆ›å»º.. 
å¦‚: test.pp  
user{'11':
    name => xu,
    ensure => present,
}

å°±æ˜¯è¯´åˆ›å»ºä¸€ä¸ª xuç”¨æˆ·.


ğŸ”µ ç¼–å†™ site.pp æ–‡ä»¶
é‚£ä¸ªå®¢æˆ·ç«¯.è¿è¡Œé‚£ä¸ªæ¨¡å—. éƒ½å¯ä»¥æŒ‡å®šçš„...

$puppetserver = 'VM-C7'
node 'mail.0214.help'{
  include  motd
}




ğŸ”µ æµ‹è¯• 
å®¢æˆ·ç«¯å»æ‰§è¡Œ. .. 
puppet agent --test


âœ  ~ puppet agent --test
Info: Caching certificate for mail.0214.help
Info: Caching certificate_revocation_list for ca
Error: Could not request certificate: SSL_connect returned=1 errno=0 state=error: certificate verify failed: [certificate revoked for /CN=localhost.localdomain]
Exiting; failed to retrieve certificate and waitforcert is disabled

ğŸ‘¹ certificate revoked for /CN=localhost.localdomain
è¯ä¹¦è¿‡æœŸ..  åé¢æ˜¯æœåŠ¡å™¨çš„ ä¸»æœºå..










====mac å®¢æˆ·ç«¯
åˆ é™¤;
sudo rm -rf ~/.puppet && sudo rm -rf ~/.puppetlabs && sudo rm -rf /opt/puppetlabs && sudo rm -rf /etc/puppet && sudo rm -rf /etc/puppetlabs && sudo rm -rf /usr/bin/puppet

é‡æ–°å®‰è£….
å®‰è£…è¿‡ç¨‹ä¸­ hostname å¡«å†™. VM-C7
certname å¡«å†™xu-jian.local


ç¼–è¾‘ hostsæ–‡ä»¶...
ç”±äºæœåŠ¡å™¨ip æ˜¯192.168.169.111
è¿™é‡Œå°±æŠŠ VM-C7 è§£æåˆ° 192.168.169.111äº†...

ç¼–è¾‘ puppet.conf

ç„¶åå»å®¢æˆ·ç«¯ puppet agent --test ..


è¿˜æ˜¯é‡è£…æœåŠ¡å™¨å§.  
å¿…é¡»å…ˆæ”¹å ç„¶åæ‰æ˜¯ å®‰è£…puppet-server.
ç»å¯¹ä¸è¦å…ˆå®‰è£…åæ”¹å. ä¼šå‡ºä¸€å †é—®é¢˜çš„...





å››ã€Hello World

åœ¨masterèŠ‚ç‚¹æ–°å»ºsite.ppæ–‡ä»¶

[root@master ~]# vim /etc/puppet/manifests/site.pp
node slave01 {
  file {
    "/tmp/testpuppet": #åœ¨slaveèŠ‚ç‚¹ä¸Šåˆ›å»ºè¯¥æ–‡ä»¶
    content=>"good morning!\n"; #æ–‡ä»¶ä¸­æ‰“å°å¦‚ä¸‹å†…å®¹
  }
}
åœ¨slaveèŠ‚ç‚¹ä¸­è¯·æ±‚æ–°é…ç½®

[root@slave01 ~]# puppetd --test --server master
info: Caching catalog for slave01
info: Applying configuration version '1450250442'
notice: Finished catalog run in 0.03 seconds
[root@slave01 ~]# cat /tmp/testpuppet #å¯ä»¥çœ‹åˆ°å·²ç”Ÿæˆè¯¥æ–‡ä»¶
good morning!






â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
é¦–å…ˆ ä½ å¾—å¤§æ¦‚çŸ¥é“puppet æœ‰å¤šå°‘å­å‘½ä»¤. æ¯ä¸ªpuppet å­å‘½ä»¤åˆæœ‰å“ªäº›action..
âœ˜âœ˜âˆ™ğ’— pp puppet help

Usage: puppet <subcommand> [options] <action> [options]

Available subcommands:

  agent             The puppet agent daemon
  apply             Apply Puppet manifests locally
                    âœ åœ¨å®¢æˆ·ç«¯æœ¬åœ°è¿è¡Œxx.pp 

  cert              Manage certificates and requests
                    âœ è¯ä¹¦ç›¸å…³å‘½ä»¤.

  config            Interact with Puppet's settings.
 
  facts             Retrieve and store facts.

  lookup            Data in modules lookup function

  master            The puppet master daemon
  module            Creates, installs and searches for modules on the Puppet Forge.

  node              View and manage node definitions.
  parser            Interact directly with the parser.
  plugin            Interact with the Puppet plugin system.









ğŸ”µ puppet apply 

puppet agent å®¢æˆ·ç«¯é»˜è®¤éƒ½æ˜¯ä»æœåŠ¡å™¨ä¸‹è½½é…ç½®æ–‡ä»¶.ç„¶åå†æ‰§è¡Œè¿™ä¸ªé…ç½®æ–‡ä»¶.
puppet apply å®¢æˆ·ç«¯å½“ç„¶ä¹Ÿå¯ä»¥ä¸ä»æœåŠ¡å™¨ä¸‹è½½.è€Œæ˜¯ç›´æ¥è¿è¡Œæœ¬åœ°çš„é…ç½®æ–‡ä»¶.

ğŸ”¸é…ç½®æ–‡ä»¶:
config.pp
class puppet::config{
  include puppet::params
  file { '/etc/puppet/puppet.conf':
    ensure  => present,
    content => template('puppet/puppet.conf.erb'),
    owner   => 'root',
    group   => 'root',
    mode    => '0644',
    require => Class['puppet::install'],
    notify  => Class['puppet::service'],  #é…ç½®æ›´æ–°åä¸»åŠ¨é€šè¿‡puppetæœåŠ¡é‡å¯
  }
}

ğŸ”¸ æ¨¡æ‹Ÿæ‰§è¡Œè¿™ä¸ªé…ç½®æ–‡ä»¶.
âœ˜âœ˜âˆ™ğ’— pp puppet apply config.pp --noop --verbose











ğŸ”µ puppet help agent

USAGE
-----
puppet agent [--certname <NAME>] [-D|--daemonize|--no-daemonize]
  [-d|--debug] [--detailed-exitcodes] [--digest <DIGEST>] [--disable [MESSAGE]] [--enable]
  [--fingerprint] [-h|--help] [-l|--logdest syslog|eventlog|<FILE>|console]
  [--masterport <PORT>] [--noop] [-o|--onetime] [-t|--test]
  [-v|--verbose] [-V|--version] [-w|--waitforcert <SECONDS>]


ä¸»è¦å‚æ•°
[-v|--verbose]
[-t|--test]
































