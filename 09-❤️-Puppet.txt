ğŸ”µ ç®€ä»‹
                                  â¤ï¸â¤ï¸ï¸â¤ï¸ Puppet æå“å…¥é—¨æ•™ç¨‹ â¤ï¸â¤ï¸â¤ï¸
     http://www.zsythink.net/archives/category/%E8%BF%90%E7%BB%B4%E7%9B%B8%E5%85%B3/puppet/

                â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸å®‰è£…puppet-server ä¼šè‡ªåŠ¨å®‰è£… puppet-agent.â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸
                â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸å®‰è£…puppet-server ä¼šè‡ªåŠ¨å®‰è£… puppet-agent.â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸
                          ä¸ç®¡ä»€ä¹ˆç”µè„‘è¦ç”¨puppetå®‰è£… puppet-server å°±å¯¹äº†.
                                puppet-server æœ‰å¾ˆå¤šç‰ˆæœ¬ æœ€æ–°æ˜¯ 4.10
                                puppet-agent  æœ‰å¾ˆå¤šç‰ˆæœ¬ æœ€æ–°æ˜¯ 1.10
                        æœ€æ–°ç‰ˆçš„puppet-server æœ€å¥½è¿æ¥æœ€æ–°ç‰ˆçš„ puppet-agent
                        é«˜ç‰ˆæœ¬çš„puppet-server å¯ä»¥è¿æ¥ä½ç‰ˆæœ¬çš„ puppet-agent
                        ä½ç‰ˆæœ¬çš„puppet-server ä¸èƒ½è¿æ¥é«˜ç‰ˆæœ¬çš„ puppet-agent
                           æ‰€ä»¥: æœåŠ¡å™¨å°½é‡å®‰è£…æœ€æ–°ç‰ˆæœ¬. å®¢æˆ·ç«¯ç›¸å¯¹æ— æ‰€è°“.

                        ğŸ“Œåˆ«åœ¨Macä¸ŠæŠ˜è…¾ puppet-agent. æˆ‘åæ­£åŠå¤©æ²¡æŠ˜è…¾æˆåŠŸğŸ“Œ
    ğŸ”¸ç›®çš„: åœ¨æ— å…¬ç½‘IPçš„Centos7è™šæ‹Ÿæœºä¸Šæ­å»º puppet-server æœåŠ¡å™¨. æ§åˆ¶æœ‰å…¬ç½‘IPçš„ vps.(puppet-agent)ğŸ”¸




ğŸ”µ å››ä¸ªç»„ä»¶:
    ğŸ”¸puppet-server    Puppet Server. ä¼šè‡ªåŠ¨å®‰è£… puppet-agent!!!
    ğŸ”¸puppet-agent     å¤šåˆä¸€å®‰è£…åŒ….ä¼šå®‰è£… Puppet-agent, Ruby, Facter.ç­‰å„ç§ä¾èµ–.
    ğŸ”¸puppetdb         æ•°æ®åº“. å¯ä»¥æ›´å¥½çš„ä½¿ç”¨ puppet.
    ğŸ”¸facter           è·å–æ•°æ®ä¼ ç»™æœåŠ¡å™¨.

        Puppet: C/Sæ¶æ„è½¯ä»¶.
            ğŸ“ŒæœåŠ¡å™¨ä¸€èˆ¬è¦å®‰è£… puppet-server å’Œ facter
            ğŸ“Œå®¢æˆ·ç«¯ä¸€èˆ¬è¦å®‰è£… puppet        å’Œ facter


ğŸ”µ Puppet å·¥ä½œæµç¨‹

    puppetæ˜¯æ‰¹é‡ç®¡ç†æœåŠ¡å™¨çš„, æ¯”å¦‚è¦å®‰è£…/è¾“å‡º/æ›´æ–°è½¯ä»¶ã€æ–°å»º/åˆ é™¤ç”¨æˆ·ã€å¯åŠ¨/åœæ­¢è¿›ç¨‹...
    æ‰€æœ‰çš„é…ç½®æ–‡ä»¶éƒ½æ˜¯å‚¨å­˜åœ¨æœåŠ¡å™¨ä¸­.å®¢æˆ·ç«¯æ¯åŠå°æ—¶è¿ä¸€æ¬¡æœåŠ¡å™¨. çœ‹æœåŠ¡å™¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰æ›´æ–°.
    å¦‚æœæœ‰æ›´æ–°.å°±ä¸‹è½½é…ç½®æ–‡ä»¶.ç„¶ååœ¨æœ¬åœ°æ‰§è¡Œ

    å®¢æˆ·ç«¯çš„facter ä¼šè·å–å®¢æˆ·ç«¯è‡ªå·±ç”µè„‘çš„ä¿¡æ¯(å¦‚ä¸»æœºåï¼Œå†…å­˜å¤§å°ï¼Œipåœ°å€ç­‰) å‘é€ç»™æœåŠ¡å™¨.
    æœåŠ¡å™¨çš„facter æ ¹æ®å®¢æˆ·ç«¯ä¸»æœºå.åœ¨æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°å¯¹åº”çš„é…ç½®.æ¥åˆ†æå®¢æˆ·ç«¯æ˜¯å¦æˆåŠŸæ‰§è¡Œ

    å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ˜¯åŸºäºSSLè¯ä¹¦çš„.
    ä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥è¯·æ±‚è¿æ¥æœåŠ¡å™¨. ä½†æ˜¯åªæœ‰åœ¨æœåŠ¡å™¨åŒæ„åæ‰å¯ä»¥å’ŒæœåŠ¡å™¨é€šä¿¡!!

    puppet  ä¼šè®©ç³»ç»Ÿä¿æŒåœ¨äººä»¬æ‰€æœŸæœ›çš„æŸç§çŠ¶æ€å¹¶ä¸€ç›´ç»´æŒä¸‹å».ä¾‹å¦‚ï¼š
        ä¿è¯æŸä¸ªæ–‡ä»¶ä¸€ç›´å­˜åœ¨ï¼Œ å¦‚æœè¯¥æ–‡ä»¶è¢«åˆ é™¤äº†   puppetä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰ä¼šé‡æ–°åˆ›å»ºæ–‡ä»¶.
        ä¿è¯sshæœåŠ¡å§‹ç»ˆå¼€å¯ï¼Œ  å¦‚æœsshæœåŠ¡è¢«å…³é—­äº†  puppetä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰ä¼šé‡å¯sshæœåŠ¡.

    ä¸¤è€…æ˜¯é€šè¿‡ https å»ºç«‹è¿æ¥.  æœåŠ¡ç«¯ç«¯å£é»˜è®¤ 8140




ğŸ”µ å‚¨å¤‡çŸ¥è¯† rpm

    RPMè½¯ä»¶åŒ…çš„ç®¡ç†å·¥å…·.æœ€åˆæ˜¯ red hatç”¨æ¥ç®¡ç†linuxè½¯ä»¶ç¨‹åºçš„,ç”±äºéå¸¸å¥½ç”¨,è¢«centosç­‰ç³»ç»Ÿé‡‡ç”¨äº†.

    ğŸ”¸è¯­æ³•: rpm  âœš é€‰é¡¹  âœš è½¯ä»¶å.

    ğŸ”¸é€‰é¡¹:
        -i  æ˜¾ç¤ºå¥—ä»¶çš„ç›¸å…³ä¿¡æ¯ï¼› 
        -v  æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼› 
        -h  å¥—ä»¶å®‰è£…æ—¶åˆ—å‡ºæ ‡è®°ï¼› 
        -q  ä½¿ç”¨è¯¢é—®æ¨¡å¼ï¼Œå½“é‡åˆ°ä»»ä½•é—®é¢˜æ—¶ï¼ŒrpmæŒ‡ä»¤ä¼šå…ˆè¯¢é—®ç”¨æˆ·ï¼›
        -l  æ˜¾ç¤ºå¥—ä»¶çš„æ–‡ä»¶åˆ—è¡¨ï¼›

    ğŸ”¸å¸¸ç”¨é€‰é¡¹ç»„åˆ
        rpm -ivh       å®‰è£…è½¯ä»¶
        rpm -ql        æŸ¥çœ‹è½¯ä»¶å®‰è£…ä½ç½®.
        rpm --force -i â—ï¸â—ï¸â—ï¸â—ï¸å¼ºåˆ¶å®‰è£…â—ï¸â—ï¸â—ï¸â—ï¸
                æ­£å¸¸ä¸€èˆ¬æ·»åŠ å¯¹åº”æºä¹‹åå°±å¯ä»¥ç”¨ yum æ¥å®‰è£…å¯¹åº”çš„è½¯ä»¶äº†.
                ä½†æ˜¯å¦‚æœ rpm -ivh å®‰è£…è¿‡ç¨‹æŠ¥é”™. æœ€åyum install xxx æç¤º  command not found 
                å°±å¯ä»¥ç”¨å¼ºåˆ¶å®‰è£…!!!
                rpm -ivh http://yum.puppetlabs.com/puppetlabs-release-el-6.noarch.rpm
                    ğŸ‘¹ package puppetlabs-release-22.0-2.noarch is already installed

                rpm --force -i http://yum.puppetlabs.com/puppetlabs-release-el-6.noarch.rpm
                è¿™ä¸‹å°±å¥½äº†!!!  



ğŸ”µ Puppet ç›®å½•ç»“æ„ç®€ä»‹

    ğŸ”¸Centos6    ls -1 /etc/puppet/     
        auth.conf         #å®šä¹‰puppet masterçš„aclæ–‡ä»¶
        fileserver.conf   #å®šä¹‰puppet masteræ–‡ä»¶æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶
        manifests         #puppetè„šæœ¬ä¸»æ–‡ä»¶ç›®å½•ï¼Œsite.ppæ–‡ä»¶å¿…é¡»å­˜åœ¨
        modules           #puppetæ¨¡å—ç›®å½•
        puppet.conf       #puppetä¸»é…ç½®æ–‡ä»¶
        ssl               #å­˜æ”¾sslè¯ä¹¦çš„ç›®å½•

ğŸ”µ ç›¸å…³èµ„æº

        â—ï¸â—ï¸â—ï¸â—ï¸puppetå®˜æ–¹yumæº: https://yum.puppetlabs.com/
            ä¸åŒçš„ç³»ç»Ÿé€‰æ‹©ä¸åŒçš„æº.  æ¯”å¦‚ centos6 å’Œcentps7 å°±æœ‰åŒºåˆ«.
      
        puppet server å®˜ç½‘å®‰è£…æ•™ç¨‹  https://docs.puppet.com/puppetserver/2.7/install_from_packages.html
        puppet agent  å®˜ç½‘å®‰è£…æ•™ç¨‹  https://docs.puppet.com/puppet/4.10/install_osx.html

ğŸ”µ å¸¸ç”¨å‘½ä»¤

    ğŸ”…puppet help æŸ¥çœ‹å„ç§å‘½ä»¤.
    ğŸ”…puppet -V   æŸ¥çœ‹ç‰ˆæœ¬.æ¥ç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸ.

    ğŸ”…puppet help agent                æŸ¥çœ‹agentè¯¥å­å‘½ä»¤çš„è¯¦ç»†ç”¨æ³•.
        puppet agent -V/--version    æŸ¥çœ‹ç‰ˆæœ¬
        puppet agent --verbose/-v    è¯¦ç»†è¾“å‡ºå‘½ä»¤.  
        puppet agent --test / -t     æµ‹è¯•è¿æ¥.
        puppet agent --noop          æ¨¡æ‹Ÿè¿è¡Œ.
        puppet agent --debug/-d   
        puppet agent --certname <NAME>


    ğŸ”¸è¯ä¹¦ç›¸å…³å‘½ä»¤:.
        puppet cert list                     åˆ—å‡ºæœªç­¾åè¯·æ±‚. (æœªç­¾åæœ€å‰é¢æ²¡æœ‰+å·)
        puppet cert list --all               åˆ—å‡ºæ‰€æœ‰çš„ç­¾å. åŒ…æ‹¬å·²ç­¾åçš„(å·²ç­¾åæœ€å‰é¢æœ‰ä¸ª+å·)
        puppet cert sign host2.example.com   ç»™æŸä¸ªå®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œç­¾å(æœåŠ¡å™¨ä¸Šæ“ä½œ).
        puppet cert sign --all               ç»™æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œç­¾å(æœåŠ¡å™¨ä¸Šæ“ä½œ).



        ss -tlunp | grep puppet           æŸ¥çœ‹puppetçš„ç«¯å£ é»˜è®¤8140

        ğŸ‘â€ğŸ—¨ å‡çº§ç‰ˆæœ¬. å…ˆå¸è½½(yum remove puppet-server) å†å®‰è£…



        ğŸ”… vim /etc/puppet/puppet.conf     åŠ å…¥ä¸‹é¢ä¸‰è¡Œ
              listen = true
              server = master.fansik.com
              runinterval = 30               
        ğŸ”… /etc/init.d/puppet start        å¯åŠ¨æœåŠ¡
        ğŸ”… chkconfig puppet on             è®¾ç½®å¼€æœºè‡ªå¯åŠ¨



    puppet agent -v      âœ verbose væ¨¡å¼.è¿™æ ·æ‰ä¼šå‡ºç°æŠ¥é”™ä¿¡æ¯.æ‰èƒ½å¯¹é—®é¢˜è¿›è¡Œåˆ†æ.
    puppet agent -d      âœ è¿›å…¥debugæ¨¡å¼.. debug æ’é”™!!! æ¯”-væ¨¡å¼æ›´åŠ è¯¦ç»†.







â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¤ï¸è½¯ä»¶å®‰è£…â¤ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
â¤ï¸CentOS6 å®‰è£… (è¯¦ç»†)

    ğŸ”µä¾èµ–ç¯å¢ƒ
        ğŸ”¸ lsb_release -a                æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬. âœ  Description:	CentOS release 6.9 (Final)
        ğŸ”¸ uname -a                      æŸ¥çœ‹ç³»ç»Ÿæ˜¯32ä½è¿˜æ˜¯64ä½. åªæœ‰è¾“å‡ºæ˜¯x86_64 æ‰æ˜¯64ä½çš„. å…¶ä»–éƒ½æ˜¯32ä½çš„!!!!
        ğŸ”¸ yum install ruby ruby-rdoc    å®‰è£…rubyç¯å¢ƒ.
        ğŸ”¸ æ·»åŠ puppet çš„å®˜æ–¹yumæº.
            rpm -ivh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-6.noarch.rpm
            â—ï¸â—ï¸è¿™ä¸ªPC1æº(Puppet Collections)æ‰å¯ä»¥å®‰è£…4.+ç‰ˆæœ¬ â—ï¸â—ï¸

                    rpm -ivh http://yum.puppetlabs.com/puppetlabs-release-el-6.noarch.rpm
                    ğŸ‘â€ğŸ—¨ è¿™ä¸ªæºæœ€é«˜åªèƒ½å®‰è£… 3.8.7çš„ç‰ˆæœ¬!! åˆ«ç”¨è¿™ä¸ªæº.

                    ğŸ‘¹ package puppetlabs-release-22.0-2.noarch is already installed
                    å¦‚æœå‡ºç° xxx is already installed ç±»ä¼¼æç¤º.  ç”¨ rpm --force -i  âœš ç½‘å€ å¼ºåˆ¶å®‰è£….
                    rpm --force -i http://yum.puppetlabs.com/puppetlabs-release-el-6.noarch.rpm
                    rpm --force -i https://yum.puppetlabs.com/puppetlabs-release-pc1-el-6.noarch.rpm

    ğŸ”µå®‰è£…puppet-server
        ğŸ”¸yum install puppetserver
            ğŸ‘â€ğŸ—¨ 4+ ç‰ˆæœ¬å’Œ3+çš„å®‰è£…å‘½ä»¤æ˜¯ä¸ä¸€æ ·çš„ 3+ çš„å¥½åƒæ˜¯: yum install puppetmaster
            Serveré»˜è®¤å¯¹å†…å­˜è¦æ±‚é«˜å¾—2G... 256mçš„vpsè·‘ä¸ªå®¢æˆ·ç«¯å°±å¯ä»¥äº†åˆ«è·‘æœåŠ¡ç«¯äº†...
        ğŸ”¸ é…ç½®ç¯å¢ƒè·¯å¾„
                å®‰è£…å¥½åä½ ä¼šå‘ç°ä¸èƒ½æ‰§è¡Œpuppetå‘½ä»¤!
                    ğŸ‘â€ğŸ—¨ å¦‚æœä½ ç”¨çš„æ˜¯ 3.8.7 çš„é‚£ä¸ªæºæ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨puppetå‘½ä»¤çš„.ä¹Ÿå°±ä¸éœ€è¦é…ç½®ç¯å¢ƒè·¯å¾„. 
                æ­£å¸¸ puppet agent -V å°±èƒ½æ˜¾ç¤ºå½“å‰å®¢æˆ·ç«¯ç‰ˆæœ¬çš„.
                ğŸ“ŒPuppet4 çš„å˜åŒ–æ¯”è¾ƒå¤§. 
                    ğŸ‘â€ğŸ—¨ é…ç½®è·¯å¾„: /etc/pupperlabs
                    ğŸ‘â€ğŸ—¨ ç¨‹åºè·¯å¾„: /opt/puppetlabs
                ç›´æ¥å»ç¨‹åºå®‰è£…è·¯å¾„å»çœ‹çœ‹èƒ½ä¸èƒ½æ‰§è¡Œ.
                cd /opt/puppetlabs/bin
                ./puppet agent -V
                    è¿™ä¸‹å°±æ˜¾ç¤ºå‡ºå½“å‰ç‰ˆæœ¬äº†!è¯´æ˜å®‰è£…æˆåŠŸçš„.è‡ªå·±é…ä¸‹ç¯å¢ƒè·¯å¾„å°±å¥½äº†. 
                    è¿™ä¸€è¿™ä¸ªå‘½ä»¤å‰çš„ ./ è¿™ä¸ªè¡¨ç¤ºå½“å‰æ–‡ä»¶å¤¹!!!!

                ä¸‹é¢æˆ‘ä»¬æ‰‹åŠ¨æŠŠ /opt/puppetlabs/bin   è¿™ä¸ªè·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒè·¯å¾„ä¸­!!
                ä»¥åä»»ä½•ä½ç½®éƒ½å¯ä»¥è¿è¡Œpuppetå‘½ä»¤äº†. è€Œä¸æ˜¯å¿…é¡»cdåˆ°puppetçš„å®‰è£…è·¯å¾„ä¸‹æ‰èƒ½è¿è¡Œpuppetå‘½ä»¤.
                ç¯å¢ƒè·¯å¾„ å’Œä½ ä½¿ç”¨çš„sehllæœ‰å…³. 
                æˆ‘ç”¨zsh é‚£ä¹ˆåªè¦åœ¨  ~/.zshrc è¿™ä¸ªæ–‡ä»¶é‡ŒåŠ ä¸‹é¢è¡Œ.ç„¶åé‡å¯shellç”Ÿæ•ˆ.
                export PATH=/opt/puppetlabs/bin:$PATH
                åœ¨æ–‡ä»¶å°¾éƒ¨æ·»åŠ ä¸€è¡Œ æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨echo. å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨viæ·»åŠ .
                ğŸ”… echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.zshrc
                ğŸ‘â€ğŸ—¨ è¿™é‡Œå¿…é¡»ç”¨ å•å¼•å·. å•å¼•å·é‡Œé¢çš„å†…å®¹æ‰ä¼šä¸€æ¨¡ä¸€æ ·çš„è¿½åŠ åˆ°æ–‡ä»¶ä¸­.ä¸ç„¶$PATHè¿™ä¸ªå˜é‡ä¼šå±•å¼€.
                ğŸ‘â€ğŸ—¨ æ·»åŠ å˜é‡åè®°å¾—é‡å¯shell. æœåŠ¡å™¨çš„è¯.æ–­å¼€ssh é‡æ–°è¿å°±å¯ä»¥äº†.

                
â¤ï¸ CentOS 7x64 å®‰è£…é…ç½® (ç®€å•)

    ğŸ”¸ yum install ruby ruby-rdoc             âœ å®‰è£…rubyç¯å¢ƒ.
    ğŸ”¸ rpm -ivh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-6.noarch.rpm   æ·»åŠ puppet çš„å®˜æ–¹yumæº.
    ğŸ”¸ yum install puppetserver               âœ å®‰è£…puppet-server 
    ğŸ”¸  vi /etc/sysconfig/puppetserver        âœ ä¿®æ”¹å†…å­˜è¦æ±‚.   
        JAVA_ARGS="-Xms2g -Xmx2g"             âœ è¿™è¡Œçš„2gæ”¹æ‰å¦‚:
        JAVA_ARGS="-Xms256m -Xmx256m"
    ğŸ”¸ ç¯å¢ƒè·¯å¾„(æŒ‰bashé€‰ä¸€ä¸ªå°±å¯ä»¥)
        echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.bash_profile
        echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.zshrc
    ğŸ”¸ é‡å¯shell
    ğŸ”¸ puppetserver start                     âœ å¯åŠ¨puppet-server 
    ğŸ”¸ service puppetserver status            âœ æŸ¥çœ‹puppetserver è¿è¡ŒçŠ¶æ€.  
    ğŸ”¸ namp 127.0.0.1                         âœ æŸ¥çœ‹ç«¯å£æ˜¯å¦æ­£å¸¸å¼€å¯
                                              âœ nmap é»˜è®¤åªæ‰«æ 1000ä¹‹å†…çš„ç«¯å£å•Š.
                                              âœ è®°å¾—åŠ å‚æ•°!!!    nmap -p 8140 127.0.0.1  
                                              âœ æˆ–è€…ç”¨ netstat -nlatp | grep 8140



â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¤ï¸ FRP å†…ç½‘ç©¿é€è®¾ç½®â¤ï¸ ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
    è§’è‰²           ç³»ç»Ÿ             IPåœ°å€    å®‰è£…è½¯ä»¶           ä¸»æœºå.
    puppet-server  Centos7(è™šæ‹Ÿæœº)  å†…ç½‘IP    puppet-server      VM-C7     
    puppet-agent   Centos6(VPS)     å…¬ç½‘IP    puppwt-agent       mail.0214.help 

è¦ä½¿ç”¨ puppet. å¿…é¡»ä¿è¯ åŒæ–¹èƒ½ç”¨åŸŸåäº’ç›¸è§£æåˆ°. 
å› ä¸º puppet æ˜¯é€šè¿‡  VM-C7 å’Œ mail.0214.help  ä¸»æœºåæ¥äº’ç›¸äº¤æµçš„!

ğŸ”µ å¦‚æœ puppet-server å’Œ puppet-agent éƒ½åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…. æ¯”å¦‚:
    puppet-server çš„IPåœ°å€æ˜¯ 192.168.1.1, ä¸»æœºåæ˜¯ master
    puppet-agent  çš„IPåœ°å€æ˜¯ 192.168.1.2, ä¸»æœºåæ˜¯ client

    é‚£ä¹ˆåŸŸåè§£æéå¸¸ç®€å•.
        åªè¦åœ¨puppet-server çš„hostsæ–‡ä»¶æ·»åŠ ä¸€è¡Œ: 192.168.1.2  client
            æ·»åŠ åä½ å»puppet-server ç”µè„‘å¼€ç»ˆç«¯ ping client å°±æ˜¯ping 192.168.1.2

        åªè¦åœ¨puppet-agent çš„hostsæ–‡ä»¶æ·»åŠ ä¸€è¡Œ: 192.168.1.1  master
            æ·»åŠ åä½ å»puppet-agent ç”µè„‘å¼€ç»ˆç«¯ ping master å°±æ˜¯ping 192.168.1.1

        è¿™å°±æ˜¯åŸŸåè§£æ. ä¹Ÿå°±æ˜¯æŠŠä¸€ä¸ªåå­— å¯¹åº”åˆ°ä¸€ä¸ªIPä¸Š. å°±è¿™ä¹ˆç®€å•.

ğŸ”µ å¦‚æœ puppet-server å’Œ puppet-agent ä¸åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†….æ¯”å¦‚:
    puppet-server çš„å†…ç½‘IPåœ°å€æ˜¯ 192.168.1.1,  ä¸»æœºåæ˜¯ VM-C7
    puppet-agent  çš„å…¬ç½‘IPåœ°å€æ˜¯ 23.105.192.96 ä¸»æœºåæ˜¯ mail.0214.help
    è¦å®ç°äº’ç›¸è§£æå°±éœ€è¦å¯¹ç½‘ç»œ å’Œ puppet æœ‰ç‚¹äº†è§£äº†. éœ€è¦å€ŸåŠ©å†…ç½‘ç©¿é€å·¥å…·.æ¨èç”¨frp. 
    ä¸¤å°puppetè¡¨é¢ä¸Šæ˜¯é€šè¿‡ åŸŸåæ¥äº’ç›¸äº¤æµçš„. å®é™…ä¸Šæ˜¯é€šè¿‡IPæ¥äº’ç›¸äº¤æµçš„.
    ç”¨åŸŸååªæ˜¯ä¸ºäº†æ–¹ä¾¿äººç±»è®°å¿†. å¥½æ¯” å§“åå’Œèº«ä»½è¯å·ç . è‚¯å®šæ˜¯å§“åå®¹æ˜“è®°å•Š..

    å†æ·±å…¥ä¸€ç‚¹. æœåŠ¡å™¨å¯ä»¥åŒæ—¶è¿è¡Œå¾ˆå¤šè½¯ä»¶.ä¸€èˆ¬ä¸€ä¸ªæœåŠ¡å™¨ä¹Ÿå°±ä¸€ä¸ªå¤–ç½‘IP.
    ç”µè„‘ä¸Šçš„æ¯ä¸ªè½¯ä»¶åªç”¨äº†IPçš„å‡ ä¸ªç«¯å£è€Œå·².
    æ¯”å¦‚ç½‘é¡µ:   http çš„80ç«¯å£ã€https çš„443ç«¯å£.
    æ¯”å¦‚puppet: puppet-server çš„8140ç«¯å£. puppet-agent çš„8139ç«¯å£.

    å…¶å® puppet-server å’Œ puppet-agent ä¹‹é—´ç”¨çš„æ˜¯ http åè®®.
    puppet-agent é€šè¿‡ç”µè„‘ä¸Šçš„8139ç«¯å£ å‘æ¶ˆæ¯ç»™ puppet-server ä¸Šçš„8140ç«¯å£.
    æ—¢ç„¶ç«¯å£æ˜¯ç¡®å®šçš„. æˆ‘ä»¬ä¸ç”¨ç®¡.é‚£ä¹ˆæˆ‘ä»¬åªè¦è§£å†³IPé—®é¢˜å°±å¥½äº†. 
    puppet-agent æœåŠ¡å™¨æ˜¯æœ¬èº«å¸¦æœ‰å…¬ç½‘IPçš„. ä»»ä½•ç”µè„‘è¦è§£æåˆ°puppet-agentå¾ˆç®€å•.  è§£æå¯ä»¥ç†è§£æˆè¿æ¥. æ¯”å¦‚sshè¿æ¥.
    puppet-server æ˜¯å†…ç½‘ç”µè„‘.æ²¡æœ‰IPçš„.     ä»»ä½•ç”µè„‘è¦è§£æåˆ°puppet-serverå°±å¾ˆéš¾. ç”¨äº† frpå°±å¾ˆç®€å•!!!
    frp åŸç†è¿™é‡Œä¸è¯´. è‡ªå·±çœ‹ frp.txtå».


ğŸ”µ FRPæœåŠ¡å™¨è®¾ç½® (Centos6 VPS å…¬ç½‘IP: 23.105.192.96)
    vi frps.ini                 âœ ç¼–è¾‘frpæœåŠ¡å™¨é…ç½®æ–‡ä»¶,æ·»åŠ ä¸‹é¢ä¸‰è¡Œ: 
    [vm-centos7-puppetserver]   âœ æ¨¡å—åå­—. åå­—ä»»æ„å–.ä½†æ˜¯å¿…é¡»å’Œfrpå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸­çš„æ¨¡å—åä¸€æ ·.
    auth_token = 123            âœ å¯†ç . æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ äº¤æµè¦å…ˆå¯¹æ¯”å¯†ç çš„. åŒæ–¹å¯†ç ä¸€ç›´æ‰å¯ä»¥æˆåŠŸè¿ä¸ŠæœåŠ¡å™¨.
    listen_port = 8140          âœ è¿™ä¸ªå°±æ˜¯é‡ç‚¹äº†. è¿™ä¸ªæ˜¯frpæœåŠ¡å™¨ç«¯å£.
                                âœ å¦‚æœæœ‰äººè®¿é—®23.105.192.96:8140 é¦–å…ˆæ˜¯è¿æ¥åˆ°frpæœåŠ¡å™¨è¿™å°ç”µè„‘.
                                âœ ç„¶åfrpæœåŠ¡å™¨å°±ä¼šæŠŠè¿™ä¸ªç«¯å£çš„æ‰€æœ‰æ•°æ®è½¬å‘ç»™æˆ‘ä»¬ç­‰ä¸‹å°±å»è®¾ç½®çš„å®¢æˆ·ç«¯.
                                âœ æ–‡ä»¶ç¼–è¾‘å¥½åéœ€è¦é‡å¯frpæœåŠ¡.

    ğŸ”¸ pidof frps                    âœ æ‰¾å‡ºfrpsè¿›ç¨‹: 
    ğŸ”¸ kill xxx                      âœ æ€æ­»frpsè¿›ç¨‹. ä¹Ÿå°±æ˜¯åœæ­¢ç¨‹åºäº†.
    ğŸ”¸ ./frps -c ./frps.ini          âœ æµ‹è¯•å¯åŠ¨. æœ‰é”™è¯¯ä¼šæŠ¥é”™! æ²¡æŠ¥é”™å†ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œåå°é•¿æœŸè¿è¡Œ..
    ğŸ”¸ nohup ./frps -c ./frps.ini &  âœ åå°è¿è¡Œ.æ–­å¼€sshä¹Ÿæ²¡å…³ç³».



ğŸ”µ FRPå®¢æˆ·ç«¯è®¾ç½® (puppet-server Centos7 è™šæ‹Ÿæœº)
    ğŸ”¸ä¸‹è½½å¯¹åº”çš„å®¢æˆ·ç«¯ wget https://github.com/fatedier/frp/releases/download/v0.9.3/frp_0.9.3_linux_386.tar.gz
    ğŸ”¸ è§£å‹æ–‡ä»¶        tar -xzf 
    ğŸ”¸ vi frpc.ini  ç¼–è¾‘frpå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶
    [common]                       âœ åˆ«åŠ¨; è¿æ¥FRPæœåŠ¡å™¨çš„æ¨¡å—åç§°.
    server_addr = 23.105.192.96    âœ ä¿®æ”¹; FRPæœåŠ¡å™¨IP    
    server_port = 7000             âœ ä¸ç®¡; FRPæœåŠ¡å™¨ç«¯å£. 

    auth_token = 123               âœ ä¸ç®¡
    privilege_token = 12345678     âœ ä¸ç®¡

    [vm-centos7-puppetserver]      âœ é‡ç‚¹! è¿™ä¸ªéœ€è¦å’ŒFRPæœåŠ¡å™¨ä¸Šçš„æ¨¡å—åå¯¹åº”.
    local_port = 8140              âœ é‡ç‚¹! ä»»ä½•æ•°æ®è®¿é—®æœåŠ¡å™¨ä¸Šçš„ 8140ç«¯å£ 23.105.192.96:8140 
                                        FRPæœåŠ¡å™¨ å°±ä¼šæŠŠæ•°æ®è½¬å‘åˆ°è¿™å°ç”µè„‘. ä½†æ˜¯è¿™å°ç”µè„‘æœ‰å¾ˆå¤šç«¯å£. 
                                        local_port=8140çš„æ„æ€å°±æ˜¯ è½¬å‘åˆ°8140è¿™ä¸ªç«¯å£
                                        ç°åœ¨åˆ«çš„iFFmpegæŒ‰é’®è¡¨é¢ä¸Šæ˜¯è®¿é—®çš„ 23.105.192.96:8140 
                                        å…¶å®ç»è¿‡frpæœåŠ¡å™¨åœ¨ä¸­è½¬å å®é™…å°±å˜æˆäº†è®¿é—® puppet-serverçš„8140ç«¯å£äº†.
                                        ä¹Ÿå°±æ˜¯åˆ«çš„ç”µè„‘æƒ³è¦è¿æ¥åˆ° pupper-server.
    ğŸ”¸nohup ./frpc -c ./frpc.ini &  âœ åå°å¯åŠ¨frp å®¢æˆ·ç«¯







â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸ åŸŸåè§£æ â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸

ğŸ”¸ å…³é—­ SELINUX
    Security-Enhanced Linuxçš„ç¼©å†™ï¼Œæ˜¯ä¸€ç§éå¸¸å®‰å…¨çš„LINUXæ¨¡å¼ã€‚
    åŸºæœ¬ä¸Šç”¨æˆ·å¾—ä¸åˆ°ä»€ä¹ˆæƒé™åœ¨è¿™ä¸ªç³»ç»Ÿä¸‹é¢ã€‚
    ğŸ”… usr/sbin/sestatus -v                       âœ æŸ¥çœ‹å½“å‰SELINUXçŠ¶æ€. 
        vi /etc/selinux/config                    âœ ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶æ¥æ°¸ä¹…å…³é—­SELINUX
        å°†SELINUX=enforcingæ”¹ä¸ºSELINUX=disabled   âœ ä¿®æ”¹åé‡å¯ç”µè„‘.


ğŸ”¸ æ–°æ‰‹å…³é—­é˜²ç«å¢™.

ğŸ”¸ æ—¶é—´è®¾ç½®
       Puppetçš„masterèŠ‚ç‚¹çš„æ—¶é—´å¿…é¡»è®¾ç½®å‡†ç¡®ï¼Œå› ä¸ºä»–å°†ç”¨äºè¯ä¹¦ç­¾å‘.å°½å¯èƒ½çš„ä½¿ç”¨NTP.

ğŸ”¸Cent0s7 æ›´æ”¹ä¸»æœºå:
        hostname                                      âœ æŸ¥çœ‹å½“å‰ä¸»æœºå.
        sudo hostnamectl --static set-hostname VM-C7  âœ æ°¸ä¹…æ›´æ”¹ä¸»æœºåæˆVM-C7


ğŸ”¸puppet-agentåŸŸåè§£æ
    vi /etc/hosts         
    23.105.192.96 VM-C7 âœ  æ·»åŠ è¿™è¡Œå°±å¯ä»¥äº†. å…¶å®ä½ ä¸ç”¨ç®¡ç«¯å£çš„ 
                        âœ è¿™ä¸ªç”µè„‘è¿è¡Œçš„æ˜¯puppet-agent é‚£ä¹ˆå®ƒè‚¯å®šæ˜¯å»è¿æ¥æœåŠ¡å™¨çš„.è‚¯å®šæ˜¯å»è¿æ¥8140ç«¯å£çš„.
                        âœ 23.105.192.96:8140 ç«¯å£çš„æ‰€æœ‰æ•°æ®.éƒ½ä¼šè¢«frpæœåŠ¡å™¨.è½¬ä¸ªpuppet-serverçš„8140ç«¯å£.

ğŸ”¸ ç¼–è¾‘puppet-agenté…ç½®æ–‡ä»¶. æ·»åŠ ä¸‹é¢ä¸¤è¡Œ.
    vi /etc/puppetlabs/puppet/puppet.confi
    [agent]
    server = VM-C7      âœ è¿™ä¸ªå°±æ˜¯ä½ è¦è¿æ¥çš„ puppet-server çš„ä¸»æœºå/åŸŸå

ğŸ”¸ puppet-agentç”³è¯·è¿æ¥æœåŠ¡å™¨
    ğŸ”… puppet agent --test
    Info: Creating a new SSL key for mail.0214.help

    puppet ä¸ºäº†ä¿¡æ¯å®‰å…¨. åŒæ–¹é‡‡ç”¨äº†SSLåè®®. ä¹Ÿå°±æ˜¯https. éœ€è¦ç”¨åˆ°è¯ä¹¦!
    å®¢æˆ·ç«¯è¿è¡Œ å°±è‡ªåŠ¨ä¼šå‘æœåŠ¡å™¨ç”³è¯·å»ºç«‹è¿æ¥. è¿™æ—¶å€™è¦å»æœåŠ¡å™¨åŒæ„å¯¹æ–¹è¿›è¡Œè¿æ¥.
    åŒæ„ä¹‹å æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å°±ä¼šé•¿æœŸä¿æŒé€šä¿¡(å®¢æˆ·ç«¯æ¯åŠå°æ—¶è¿ä¸€æ¬¡æœåŠ¡å™¨)!!!


ğŸ”¸ puppet-server æœåŠ¡å™¨æŸ¥çœ‹ ç­¾åè¯·æ±‚
    ğŸ”…puppet cert list
      "mail.0214.help" (SHA256) 6E:3F:48:F6:F1:52:18:30:F8:DD:2F:D3:7E:BA:C1:2E:1E:89:8A:0D:37:96:DF:E3:F5:79:A0:7F:85:5C:28:97
      å‡ºç°ä¸€ä¸ª å‰é¢æ²¡å¸¦åŠ å·çš„ å°±è¯´æ˜æœ‰å®¢æˆ·ç«¯æƒ³è¦è¿æœåŠ¡å™¨.å¦‚æœä½ åŒæ„å¯¹æ–¹è¿æ¥ å°±éœ€è¦ç­¾å.

ğŸ”¸ puppet-server å¯¹å®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œç­¾å
    puppet cert sign mail.0214.help
    Signing Certificate Request for:
    "mail.0214.help" (SHA256) 6E:3F:48:F6:F1:52:18:30:F8:DD:2F:D3:7E:BA:C1:2E:1E:89:8A:0D:37:96:DF:E3:F5:79:A0:7F:85:5C:28:97
    Notice: Signed certificate request for mail.0214.help
    Notice: Removing file Puppet::SSL::CertificateRequest mail.0214.help at '/etc/puppetlabs/puppet/ssl/ca/requests/mail.0214.help.pem'


ğŸ”¸puppet-server æŸ¥çœ‹æ‰€æœ‰è¯ä¹¦
    âœ  requests puppet cert list -all
    + "mail.0214.help" (SHA256) 4D:01:04:D7:4B:C8:75:D6:C2:D5:63:BA:93:46:C2:E1:D9:82:D6:97:AA:AC:A8:50:69:9F:6A:A8:67:27:67:F2
    + "mail.0214.live" (SHA256) D3:D7:DB:74:E6:53:CC:0F:EE:55:83:5E:65:A5:9B:32:4B:D6:9F:E5:DA:D1:50:67:88:31:3C:44:EE:C0:EE:92


ğŸ”¸puppet-server å¤±æ•ˆæŸè¯ä¹¦  puppet cert -revoke mail.0214.live
ğŸ”¸puppet-server åˆ é™¤æŸè¯ä¹¦  puppet cert --clean mail.0214.live
    è¯ä¹¦ç­¾åçš„è¿‡æœŸæˆ–åˆ é™¤éœ€è¦é‡å¯puppetmasteræœåŠ¡ã€‚


ğŸ”¸puppet-agent è¯ä¹¦æ“ä½œ.
    /etc/puppetlabs/puppet/ssl
    ğŸ“Œå¦‚æœå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨å‡ºé—®é¢˜. æ¸…ç©ºsslæ–‡ä»¶å¤¹ ç”¨puppet agent --test é‡æ–°ç”³è¯·è¯ä¹¦.






â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸














































